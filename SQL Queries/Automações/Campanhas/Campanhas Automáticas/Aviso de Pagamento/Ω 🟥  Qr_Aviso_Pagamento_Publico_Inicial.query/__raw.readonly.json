{
  "queryDefinitionId": "aec183a9-1b20-4a38-8628-7cf4bebb1a74",
  "name": "Qr_Aviso_Pagamento_Publico_Inicial",
  "key": "e90c30db-bf7a-4fa7-bdef-9f93d8e24540",
  "description": "Seleção do Publico Inicial para a Jornada",
  "queryText": "SELECT\n\tBASE.*\nFROM (\n\tSELECT DISTINCT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\treplace( replace( replace( replace( replace( replace( replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (C.NAME, 'á', 'a'),'é', 'e'),'í', 'i'),'ó', 'o'),'ú', 'u'),'Á', 'A'),'É', 'E'),'Í', 'I'),'Ó', 'O'),'Ú', 'U'),'à', 'a'),'À', 'A'),'ã', 'a'),'õ', 'o'),'Ã', 'A'),  'Õ', 'O'),'â', 'a'),'ê', 'e'),'ô', 'o'),'Â', 'A'),'Ê', 'E'),'Ô', 'O'),'ç', 'c'),'Ç', 'c') , '-', '') , '+', '') , '|', '') , '$', '') , '%', '') , '&', '') AS NOME,\n\t\tCASE\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 1' THEN HC_CELULAR_1__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 2' THEN HC_CELULAR_2__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3' THEN HC_CELULAR_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3_3' THEN HC_CELULAR_3_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 4' THEN HC_CELULAR_4__C\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n      WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN HC_CELULAR_3_3__C\n      WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN HC_CELULAR_4__C\n      ELSE NULL\n    END AS CELULAR,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n        P.ID AS ID_PROPOSTA,\n\t\tP.HC_SITUACAO__C,\n\t\tP.HC_DATA_DA_VENDA__C AS DATA_PROPOSTA,\n\t\tP.HC_AGENDAMENTO__C AS DATA_AGENDAMENTO,\n        format(P.HC_AGENDAMENTO__C ,'dd/MM/yyyy') AS DATA_AGENDAMENTO_FORMATADA,\n        GETDATE()+1 AS DATA_PROXIMA_EXECUCAO,\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\n\tFROM (\n\t\tSELECT\n\t\t  A.ID AS CAMPAIGN_ID,\n\t\t  B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\n\t\t  C.ID AS CONTACT_ID,\n\t\t  P.ID AS PROPOSTA_ID,\n\t\t  ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\n\t\tFROM CAMPAIGN_SALESFORCE A\n\t\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n\t\tINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__c = B.HC_CPF_CNPJ__c\n\t\tINNER JOIN HC_PROPOSTA__C_SALESFORCE P ON P.HC_CPF_CNPJ_TITULAR__C = B.HC_CPF_CNPJ__C \n\t\tWHERE\n      A.ID = '7016g000000ThNpAAK'\n      /* Momento de execução da campanha */\n      /*AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n      AND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE())*/\n      AND (A.HC_PARCEIRO__C = B.HC_PARCEIRO__C OR A.HC_PARCEIRO__C IS NULL)\n      AND A.ISACTIVE = 1\n      AND P.HC_SITUACAO__C IN ('AGUARDANDO PAGAMENTO', 'AGENDADA')\n      AND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n      AND B.HC_CLASSIFICACAO__C != 'Falecido'\n      AND HC_CONSELHEIRO__C = 0\n      AND HC_PEP__C = 0\n      AND B.HC_IDADE__C BETWEEN 18 AND 70\n      AND ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0\n      AND (ISNULL(B.HC_NAO_IMPORTUNE__C, 0) = 0 OR A.HC_VALIDA_NAO_IMPORTUNE__C = 0)\n      AND P.HC_TIPO_DE_PAGAMENTO__C = 'PM'\n      /* Celular valido e deseja receber sms */\n      AND (\n        ( B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' \n        OR B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' ) \n        AND ISNULL(B.HC_NAO_DESEJA_RECEBER_SMS__C, 0) = 0 \n      )\n      AND CONVERT(VARCHAR, P.HC_AGENDAMENTO__C, 101) = CONVERT(VARCHAR, DATEADD(DD, A.DIAS_PARA_AGENDAMENTO_DA_PROPOSTA__C, GETDATE()), 101)\n  ) FILTERED\n  INNER JOIN CAMPAIGN_SALESFORCE A ON A.ID = FILTERED.CAMPAIGN_ID\n  INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\n  INNER JOIN CONTACT_SALESFORCE C ON C.ID = FILTERED.CONTACT_ID\n  INNER JOIN HC_PROPOSTA__C_SALESFORCE P ON P.ID = FILTERED.PROPOSTA_ID\n  WHERE FILTERED.NUMBER_OF_CPF_REPETITION = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP \n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C",
  "targetName": "AVISO_PAGAMENTO_PUBLICO_INICIAL",
  "targetKey": "433EC58E-02C6-42B0-B735-7B2093BAF571",
  "targetId": "f8c15b6d-f71a-ed11-a5b6-d4f5ef66b08b",
  "targetDescription": "Base com publico inicialmente selecionado",
  "createdDate": "2022-08-15T02:01:18.07",
  "modifiedDate": "2022-12-15T09:44:35.92",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 52082,
  "isFrozen": false
}