{
  "queryDefinitionId": "c3720c9d-1778-40ae-9ff7-24f682cac93f",
  "name": "Qr00_Base_Cliente_Filtrada_Renovacao_TMKT_ONLINE",
  "key": "C3720C9D-1778-40AE-9FF7-24F682CAC93F",
  "description": "",
  "queryText": "SELECT\r\n\tBASE.*\r\nFROM (\r\n\tSELECT\r\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\r\n\t\treplace(replace( replace( replace( replace( replace( replace( replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (C.NAME, 'á', 'a'),'é', 'e'),'í', 'i'),'ó', 'o'),'ú', 'u'),'Á', 'A'),'É', 'E'),'Í', 'I'),'Ó', 'O'),'Ú', 'U'),'à', 'a'),'À', 'A'),'ã', 'a'),'õ', 'o'),'Ã', 'A'),  'Õ', 'O'),'â', 'a'),'ê', 'e'),'ô', 'o'),'Â', 'A'),'Ê', 'E'),'Ô', 'O'),'ç', 'c'),'Ç', 'c') , '-', '') , '+', '') , '|', '') , '$', '') , '%', '') , '&', '') , '¦', '') as NOME,\r\n\t\tHC_IDADE__C AS IDADE,\r\n\t\tHC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\r\n\t\tHC_GENERO_DO_CLIENTE__C AS SEXO,\r\n\t\tB.HC_PARCEIRO__C AS PARCEIRO,\r\n\t\tCASE \r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_CEP_RES__C\r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_CEP_COM__C\r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_CEP_COR__C\r\n\t\tEND AS CEP,\r\n\t\tCASE \r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_UF_RES__C\r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_UF_COM__C\r\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_UF_COR__C\r\n\t\tEND AS UF,\r\n\t\tHC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\r\n\t\t'FIXO' AS TIPO_TEL_01,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\r\n\t\t'FIXO' AS TIPO_TEL_02,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\r\n\t\t'FIXO' AS TIPO_TEL_03,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\r\n\t\t'MÓVEL' AS TIPO_TEL_04,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\r\n\t\t'MÓVEL' AS TIPO_TEL_05,\r\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\r\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\r\n\t\t'MÓVEL' AS TIPO_TEL_06,\r\n\t\tHC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\r\n\t\tHC_CLASSIFICACAO__C AS PUBLICO_ALVO,\r\n\t\tA.[TYPE] AS TIPO_CAMPANHA,\r\n\t\tA.STARTDATE AS DT_INICIO_MAILING,\r\n\t\tA.ENDDATE AS DT_FIM_MAILING,\r\n\t\tA.HC_VALIDA_ALTA_RENDA__C AS CAMPANHA_VALIDA_ENCARTEIRAMENTO,\r\n\t\tA.HC_VALIDA_NAO_IMPORTUNE__C AS CAMPANHA_NAO_IMPORTUNE,\r\n\t\tA.HC_VALIDA_RNA__C AS CAMPANHA_VALIDA_RNA,\r\n\t\tA.HC_PRODUTO__C AS ID_PRODUTO,\r\n\t\tA.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\r\n\t\tB.HC_CPF_CNPJ__C AS ID,\r\n\t\tA.ID AS ID_CAMPANHA, \r\n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\r\n\t\tC.ID AS ID_CONTATO,\r\n\t\tB.HC_Cliente__c AS ID_CLIENTE,\r\n\t\tB.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\r\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\r\n\tFROM (\r\n    SELECT\r\n      A.ID AS CAMPAIGN_ID,\r\n      B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\r\n      C.ID AS CONTACT_ID,\r\n      ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\r\n    FROM CAMPAIGN_SALESFORCE A\r\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND A.HC_TIPO_DE_CLIENTE__C = B.HC_TIPO_DE_PESSOA__C\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND A.[TYPE] = B.HC_CLASSIFICACAO__C\r\n\t\tINNER JOIN Contact_Salesforce C ON C.HC_CPF_CNPJ__c = B.HC_CPF_CNPJ__c\r\n\t\tINNER JOIN tb_Base_Inicial_Renovacao RENOV ON RENOV.CPF_CNPJ = C.HC_CPF_CNPJ__c\r\n        LEFT JOIN HC_PROPOSTA__C_SALESFORCE P ON P.HC_CPF_CNPJ_TITULAR__C = B.HC_CPF_CNPJ__C \r\n        AND DATEDIFF(DAY, CONVERT(CHAR(10), P.CREATEDDATE, 112), CONVERT(CHAR(10), GETDATE(), 112)) <= A.HC_COMPRA_RECENTE__C\r\n    LEFT JOIN TB_BASE_QUARENTENA Q ON Q.CPF_CNPJ = B.HC_CPF_CNPJ__C \r\n      AND Q.DATA_PARTICIPACAO_CAMPANHA > DATEADD(DD, -90, GETDATE())\r\n    /* Remove ja adicionados */\r\n    LEFT JOIN Publico_Apto_Clientes_TMKT_ONLINE aptos ON aptos.CPF_CNPJ = B.HC_CPF_CNPJ__C\r\n    LEFT JOIN Publico_Inapto_Clientes_TMKT_ONLINE inaptos ON inaptos.CPF_CNPJ = B.HC_CPF_CNPJ__C\r\n    WHERE\r\n\t/* Remove quarentena */\r\n      Q.CPF_CNPJ IS NULL\r\n\t\t    AND (A.HC_TIPO_DE_CLIENTE__C = 'PF')\r\n\t\t\tAND ISNULL(B.HC_CONSELHEIRO__C, 0) = 0\r\n\t\t\tAND ISNULL(B.HC_PEP__C, 0) = 0\r\n\t\t\tAND ISNULL(B.HC_NAO_DESEJA_RECEBER_LIGACOES__C, 0) = 0\r\n\t\t\tAND ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0\r\n\t\t\tAND B.HC_IDADE__C BETWEEN 18 AND 70\r\n\t\t\t/* verifica se possui sobrenome */\r\n            AND CHARINDEX(' ', C.NAME) > 0\r\n      AND (\r\n        HC_Status_Tel_Comercial__c = 'VÁLIDO'\r\n        OR HC_Status_Tel_Outro__c = 'VÁLIDO'\r\n        OR HC_Status_Tel_Residencial__c = 'VÁLIDO'\r\n        OR HC_Status_Celular_1__c = 'VÁLIDO'\r\n        OR HC_Status_Celular_2__c = 'VÁLIDO'\r\n        OR HC_Status_Celular_3__c = 'VÁLIDO'\r\n      )\r\n  ) FILTERED\r\n\tINNER JOIN CAMPAIGN_SALESFORCE A ON A.ID = FILTERED.CAMPAIGN_ID\r\n  INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\r\n  INNER JOIN Contact_Salesforce C ON C.ID = FILTERED.CONTACT_ID\r\n\tWHERE FILTERED.NUMBER_OF_CPF_REPETITION = 1\r\n) BASE\r\nINNER JOIN\r\n  CAMPAIGN_SALESFORCE CAMP\r\n  ON BASE.ID_CAMPANHA = CAMP.ID\r\n",
  "targetName": "Tb_Base_Cliente_Renovacao_TMKT",
  "targetKey": "1176CAF9-3F75-46A0-A180-31AE6842D7EE",
  "targetId": "2abc8b07-da41-ee11-a5ca-d4f5ef66afe1",
  "targetDescription": "",
  "createdDate": "2023-08-24T07:55:23.08",
  "modifiedDate": "2023-08-29T06:43:35.337",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 68066,
  "isFrozen": false
}