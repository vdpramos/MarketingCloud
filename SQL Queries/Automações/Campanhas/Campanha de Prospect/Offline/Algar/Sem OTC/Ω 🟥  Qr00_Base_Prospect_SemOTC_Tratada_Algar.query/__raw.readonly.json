{
  "queryDefinitionId": "33885e05-7d6e-41bf-804c-aba8726075e2",
  "name": "Qr00_Base_Prospect_SemOTC_Tratada_Algar",
  "key": "b87a6af2-146c-4e5e-aa79-3733326d9919",
  "description": "",
  "queryText": "SELECT DISTINCT\n    UPPER(A.NOME) AS NOME,\n\tLTRIM(RTRIM(A.CPF)) AS CPF,\n\tA.AGENCIA,\n\tA.CONTA,\n\tA.TIPO_CONTA,\n\tA.DATA_NASCIMENTO,\n\tA.SEXO,\n\tA.CEP,\n\tA.DDD_01,\n\tA.TEL_01,\n\tA.DDD_02,\n\tA.TEL_02,\n\tA.DDD_03,\n\tA.TEL_03,\n\tA.DDD_04,\n\tA.TEL_04,\n\tA.DDD_05,\n\tA.TEL_05,\n    CA.ID AS ID_CAMPANHA,\n    CA.HC_PRODUTO__C AS NOME_PRODUTO,\n    CA.HC_PRECO_DO_PRODUTO__C AS NOME_PRODUTO_VALOR,\n    CA.HC_VALIDA_ALTA_RENDA__C AS VALIDA_ENCARTEIRAMENTO,\n    CA.HC_VALIDA_RNA__C AS VALIDA_RNA,\n    CASE WHEN DATEDIFF(YY, CONVERT(VARCHAR, CONVERT(DATE, A.DATA_NASCIMENTO, 103), 112), CONVERT(VARCHAR, GETDATE(), 112)) BETWEEN 18 AND 70 THEN 1 ELSE 0 END AS IDADE_VALIDA,\n    CASE WHEN (UPPER(A.TIPO_CONTA) = 'CC' OR UPPER(A.TIPO_CONTA) = 'CONTA CORRENTE') THEN 1 ELSE 0 END AS CONTA_CORRENTE,\n    CASE WHEN Q.CPF_CNPJ IS NOT NULL THEN 1 ELSE 0 END AS QUARENTENA,\n    CASE WHEN CL.HC_CPF_CNPJ__C IS NOT NULL AND CL.HC_CLASSIFICACAO__C != 'Cliente Potencial' THEN 1 ELSE 0 END AS CLIENTE,\n    CASE WHEN CL.HC_CPF_CNPJ__C IS NOT NULL AND CL.HC_CONSELHEIRO__C = 1 THEN 1 ELSE 0 END AS CONSELHEIRO,\n\tCASE WHEN ISNULL(A.CEP, '') = '' OR A.CEP = ' ' THEN 0 ELSE 1 END AS CEP_VALIDO,\n    CONCAT(LTRIM(RTRIM(A.CPF)),'Cliente') AS CPF_TIPO_RELACIONAMENTO,\n    CONCAT(LTRIM(RTRIM(A.CPF)),'45') AS CPF_CODIGO_PARCEIRO,\n    UPPER(SUBSTRING(A.NOME, 1, CHARINDEX(' ', A.NOME) - 1)) AS PRIMEIRO_NOME,\n    UPPER(SUBSTRING(A.NOME, CHARINDEX(' ', A.NOME) + 1, LEN(A.NOME))) AS SOBRENOME,\n    CASE WHEN CA.HC_VALIDA_NAO_IMPORTUNE__C = 1 AND (N1.TELEFONE IS NOT NULL OR N2.TELEFONE IS NOT NULL OR N3.TELEFONE IS NOT NULL OR N4.TELEFONE IS NOT NULL OR N5.TELEFONE IS NOT NULL) THEN 1 ELSE 0 END AS NAO_IMPORTUNE,\n    CONVERT(VARCHAR, CONVERT(DATE, A.DATA_NASCIMENTO, 103), 112) AS DT_NASCIMENTO_SF\nFROM TB_BASE_PROSPECT_SEMOTC_ALGAR A\nINNER JOIN CAMPAIGN_SALESFORCE CA ON A.FORNECEDOR = CA.HC_FORNECEDOR__C\nLEFT JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE CL ON LTRIM(RTRIM(A.CPF)) = CL.HC_CPF_CNPJ__C\nLEFT JOIN TB_BASE_QUARENTENA Q ON LTRIM(RTRIM(A.CPF)) = Q.CPF_CNPJ\nLEFT JOIN TB_BASE_NAO_IMPORTUNE N1 ON ISNULL(CONCAT(DDD_01, TEL_01), '00000000000') = LTRIM(RTRIM(N1.TELEFONE))\nLEFT JOIN TB_BASE_NAO_IMPORTUNE N2 ON ISNULL(CONCAT(DDD_02, TEL_02), '00000000000') = LTRIM(RTRIM(N2.TELEFONE))\nLEFT JOIN TB_BASE_NAO_IMPORTUNE N3 ON ISNULL(CONCAT(DDD_03, TEL_03), '00000000000') = LTRIM(RTRIM(N3.TELEFONE))\nLEFT JOIN TB_BASE_NAO_IMPORTUNE N4 ON ISNULL(CONCAT(DDD_04, TEL_04), '00000000000') = LTRIM(RTRIM(N4.TELEFONE))\nLEFT JOIN TB_BASE_NAO_IMPORTUNE N5 ON ISNULL(CONCAT(DDD_05, TEL_05), '00000000000') = LTRIM(RTRIM(N5.TELEFONE))\nWHERE\n    CA.HC_FORNECEDOR__C = 'Algar'\nAND CONVERT(VARCHAR, CA.CREATEDDATE, 112) = CONVERT(VARCHAR, GETDATE(), 112)\nAND CA.[TYPE] = 'Prospect'\nAND CA.HC_VALIDA_RNA__C = 0",
  "targetName": "Tb_Base_Prospect_SemOTC_Tratada_Algar",
  "targetKey": "C1DFE8CB-A9BE-4A6F-A6F7-E10B895A8F9B",
  "targetId": "ab389088-2776-eb11-a2fd-48df370eabe5",
  "targetDescription": "",
  "createdDate": "2021-01-13T16:24:46.8",
  "modifiedDate": "2021-03-03T14:41:59.11",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 29368,
  "isFrozen": false
}