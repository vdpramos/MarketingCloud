{
  "queryDefinitionId": "61de0163-1c55-416f-9510-29aa37ee652c",
  "name": "Qr00_Base_Boas_Vindas_Ourocap_SemOTC_Filtrada",
  "key": "2851381d-581d-4c28-8704-e34f79e9dfb2",
  "description": "Publico inicial para campanha",
  "queryText": "SELECT\n\tA.*\nFROM (\n\tSELECT DISTINCT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\tC.NAME AS NOME,\n\t\tB.HC_IDADE__C AS IDADE,\n\t\tB.HC_PARCEIRO__C AS PARCEIRO,\n\t\tCASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_ENDERECO_RESIDENCIAL__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_ENDERECO_COMERCIAL__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_ENDERECO_CORRESPONDENCIA__C\n\t\tEND AS ENDERECO,\n\t\tCASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_UF_RES__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_UF_COM__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_UF_COR__C\n\t\tEND AS UF,\n\t\tCASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_CEP_RES__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_CEP_COM__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_CEP_COR__C\n\t\tEND AS CEP,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n\t\t\tELSE NULL\n\t\tEND AS EMAIL,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n\t\t\tELSE 0\n\t\tEND AS EMAIL_VALIDO,\n\t\tCASE\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n\t\t\tELSE NULL\n\t\tEND AS CELULAR,\n\t\tCASE\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n\t\t\tELSE 0\n\t\tEND AS CELULAR_VALIDO,\n\t\tB.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\n\t\t'FIXO' AS TIPO_TEL_01,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\n\t\t'FIXO' AS TIPO_TEL_02,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\n\t\t'FIXO' AS TIPO_TEL_03,\n\t\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\n\t\t'MÓVEL' AS TIPO_TEL_04,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\n\t\t'MÓVEL' AS TIPO_TEL_05,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\n\t\t'MÓVEL' AS TIPO_TEL_06,\n\t\tB.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n\t\tB.HC_CLASSIFICACAO__C AS PUBLICO_ALVO,\n\t\tA.STARTDATE AS DT_INICIO_MAILING,\n\t\tA.ENDDATE AS DT_FIM_MAILING,\n\t\tA.HC_PRODUTO__C AS ID_PRODUTO,\n\t\tA.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\n\t\tB.HC_CPF_CNPJ__C AS ID,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n\t\tB.HC_CLIENTE__C AS ID_CLIENTE,\n\t\tD.HC_DATA_DO_ULTIMO_RESGATE__C AS DT_ULTIMO_RESGATE,\n\t\tD.HC_VALOR_DA_PARCELA__C AS VALOR_PARCELA_PRODUTO,\n\t\tA.HC_EXCLUSAO_DE_COMPRA_RECENTE__C AS MESES_COMPRA_EXCLUSAO,\n\t\tA.HC_QUARENTENA__C AS MESES_QUARENTENA_EXCLUSAO,\n\t\tD.HC_NUMERO_DO_TITULO__C as NUMERO_DO_TITULO,\n\t\tD.HC_SERIE__C as SERIE_DO_TITULO,\n\t\tD.HC_PLANO__C as PLANO_DO_TITULO,\n\t\tD.HC_CONTRATACAO__C AS DATA_CONTRATACAO,\n\t\tCASE WHEN DATEPART(WEEKDAY, GetDate()) = 5 THEN DATEADD(DAY, 3, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) ELSE DATEADD(DAY, A.HC_PROXIMA_EXECUCAO__C, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) END AS DATA_PROXIMA_EXECUCAO,\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\n\tFROM CAMPAIGN_SALESFORCE A\n\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n\tINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\n\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID\n\tWHERE\n\t\t(B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n\t/* AND CONVERT(VARCHAR, A.HC_DATA_DE_EXECUCAO__C, 112) = CONVERT(VARCHAR, GETDATE(), 112) */\n\tAND A.ISACTIVE = 1\n\t/* ID DA CAMPANHA PAI (HEADER) DE BOAS VINDAS OUROCAP */\n\tAND A.PARENTID = '7016g000000NVrXAAW'\n\t/* AND A.HC_CAMPANHA_EXECUTADA_NO_MKT__C = 0 */\n\tAND D.HC_SITUACAO__C = 'ATIVO'\n\t/* PARCEIRO TCBB PARA OUROCAP */\n\tAND D.HC_ORIGEM__C = 'CAP'\n\tAND D.HC_CODIGO_DO_PARCEIRO_NA_ORIGEM__C = 'TCBB'\n\tAND D.HC_CONTRATACAO__C BETWEEN A.HC_DATA_INICIAL_DE_COMPRA__C AND A.HC_DATA_FINAL_DE_COMPRA__C\n\tAND (\n\t\t/* CUSTOM BETWEEN */\n\t\t(A.HC_VALOR_MINIMO_DE_PARCELA__C IS NULL OR D.HC_VALOR_DA_PARCELA__C > A.HC_VALOR_MINIMO_DE_PARCELA__C)\n\t\tAND (A.HC_VALOR_MAXIMO_DA_PARCELA__C IS NULL OR D.HC_VALOR_DA_PARCELA__C < A.HC_VALOR_MAXIMO_DA_PARCELA__C)\n\t)\n) A\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP \n  ON A.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR A.ROWNO <= CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C",
  "targetName": "Tb_Boas_Vindas_Ourocap_ComOTC_NeoBpo",
  "targetKey": "1C37A4CA-94A9-4CFD-9E3A-DC60630CF810",
  "targetId": "0031c80b-0411-ec11-a30b-48df370eabe4",
  "targetDescription": "",
  "createdDate": "2021-07-22T19:30:53.493",
  "modifiedDate": "2022-07-12T13:10:28.783",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 51193,
  "isFrozen": false
}