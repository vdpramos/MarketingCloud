SELECT
	B.CPF_CNPJ,
	B.ID_PROPOSTA,
	SUM(CASE WHEN T.HC_SITUACAO__C = 'Ativo' THEN 1 ELSE 0 END) AS TITULOS_ANTERIORES_ATIVOS,
	SUM(CASE WHEN T.HC_SITUACAO__C IS NULL OR T.HC_SITUACAO__C != 'Ativo' THEN 1 ELSE 0 END) AS TITULOS_ANTERIORES_INATIVOS
FROM Tb_Boas_Vindas_Doadin_Prospostas B
INNER JOIN CAMPAIGN_SALESFORCE CS ON CS.ID = B.ID_CAMPANHA
INNER JOIN HC_TITULO__C_SALESFORCE T ON T.HC_CLIENTE_X_PARCEIRO__C = B.ID_CLIENTE_PARCEIRO
WHERE
	T.HC_CONTRATACAO__C < CS.HC_DATA_INICIAL_DE_COMPRA__C
GROUP BY B.CPF_CNPJ,
	B.ID_PROPOSTA