SELECT DISTINCT
    UPPER(A.NOME) AS NOME,
	RIGHT(REPLICATE ('0' , 15)+CONVERT(VARCHAR, A.CPF), 11) AS CPF,
	A.AGENCIA,
	A.CONTA,
	A.TIPO_CONTA,
	A.DATA_NASCIMENTO,
	A.SEXO,
	A.CEP,
CASE WHEN A.DDD_01 IN ('11',  '12', '13', '14','15', '16','17','18', '19','21','22', '24','27', '28', '31', '32','33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47','48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82','83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97','98','99') THEN A.DDD_01 END AS DDD_01,
CASE WHEN (len(A.TEL_01) < 8 or
A.TEL_01 = '11111111' or
A.TEL_01 = '22222222' or
A.TEL_01 = '33333333' or
A.TEL_01 = '44444444' or
A.TEL_01 = '55555555' or
A.TEL_01 = '66666666' or
A.TEL_01 = '77777777' or
A.TEL_01 = '88888888' or
A.TEL_01 = '99999999' or
SUBSTRING(A.TEL_01, 1, 1) = '1') THEN '' ELSE A.TEL_01 END AS TEL_01,
CASE WHEN A.DDD_02 IN ('11',  '12', '13', '14','15', '16','17','18', '19','21','22', '24','27', '28', '31', '32','33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47','48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82','83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97','98','99') THEN A.DDD_02 END AS DDD_02,
CASE WHEN (leN(A.TEL_02) < 8 or
A.TEL_02 = '11111111' or
A.TEL_02 = '22222222' or
A.TEL_02 = '33333333' or
A.TEL_02 = '44444444' or
A.TEL_02 = '55555555' or
A.TEL_02 = '66666666' or
A.TEL_02 = '77777777' or
A.TEL_02 = '88888888' or
A.TEL_02 = '99999999' or
SUBSTRING(A.TEL_02, 1, 1) = '1') THEN '' ELSE A.TEL_02 END AS TEL_02,
CASE WHEN A.DDD_03 IN ('11',  '12', '13', '14','15', '16','17','18', '19','21','22', '24','27', '28', '31', '32','33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47','48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82','83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97','98','99') THEN A.DDD_03 END AS DDD_03,
CASE WHEN (len(A.TEL_03) < 8 or
A.TEL_03 = '11111111' or
A.TEL_03 = '22222222' or
A.TEL_03 = '33333333' or
A.TEL_03 = '44444444' or
A.TEL_03 = '55555555' or
A.TEL_03 = '66666666' or
A.TEL_03 = '77777777' or
A.TEL_03 = '88888888' or
A.TEL_03 = '99999999' or
SUBSTRING(A.TEL_03, 1, 1) = '1') THEN '' ELSE A.TEL_03 END AS TEL_03,
CASE WHEN A.DDD_04 IN ('11',  '12', '13', '14','15', '16','17','18', '19','21','22', '24','27', '28', '31', '32','33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47','48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82','83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97','98','99') THEN A.DDD_04 END AS DDD_04,
CASE WHEN (len(A.TEL_04) < 8 or
A.TEL_04 = '11111111' or
A.TEL_04 = '22222222' or
A.TEL_04 = '33333333' or
A.TEL_04 = '44444444' or
A.TEL_04 = '55555555' or
A.TEL_04 = '66666666' or
A.TEL_04 = '77777777' or
A.TEL_04 = '88888888' or
A.TEL_04 = '99999999' or
SUBSTRING(A.TEL_04, 1, 1) = '1') THEN '' ELSE A.TEL_04 END AS TEL_04,
CASE WHEN A.DDD_05 IN ('11',  '12', '13', '14','15', '16','17','18', '19','21','22', '24','27', '28', '31', '32','33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47','48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82','83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97','98','99') THEN A.DDD_05 END AS DDD_05,
CASE WHEN (len(A.TEL_05) < 8 or
A.TEL_05 = '11111111' or
A.TEL_05 = '22222222' or
A.TEL_05 = '33333333' or
A.TEL_05 = '44444444' or
A.TEL_05 = '55555555' or
A.TEL_05 = '66666666' or
A.TEL_05 = '77777777' or
A.TEL_05 = '88888888' or
A.TEL_05 = '99999999' or
SUBSTRING(A.TEL_05, 1, 1) = '1') THEN '' ELSE A.TEL_05 END AS TEL_05,
	CL.HC_Banco_1__c as Banco,
	CL.HC_Digito_da_Agencia_1__c as Digito_Verificador_Agencia,
	CL.HC_Digito_da_Conta_1__c AS Digito_Verificador_Conta,
	CL.HC_Terceiro_Digito_Conta_Corrente_1__c as Agencia_Conta_Digito_Verificador,
    CA.ID AS ID_CAMPANHA,
    CA.HC_PRODUTO__C AS NOME_PRODUTO,
    CA.HC_PRECO_DO_PRODUTO__C AS NOME_PRODUTO_VALOR,
    CA.HC_VALIDA_ALTA_RENDA__C AS VALIDA_ENCARTEIRAMENTO,
    CA.HC_VALIDA_NAO_IMPORTUNE__C AS VALIDA_NAO_IMPORTUNE,
    CA.HC_VALIDA_RNA__C AS VALIDA_RNA,
    CASE WHEN DATEDIFF(YY, CONVERT(VARCHAR(10), A.DATA_NASCIMENTO, 120), CONVERT(VARCHAR(10), GETDATE(), 120)) BETWEEN 18 AND 70 THEN 1 ELSE 0 END AS IDADE_VALIDA,
    CASE WHEN (UPPER(A.TIPO_CONTA) = 'CC' OR UPPER(A.TIPO_CONTA) = 'CONTA CORRENTE') THEN 1 ELSE 0 END AS CONTA_CORRENTE,
    CASE WHEN Q.CPF_CNPJ IS NOT NULL AND Q.DATA_PARTICIPACAO_CAMPANHA > DATEADD(DD, -90, GETDATE()) THEN 1 ELSE 0 END AS QUARENTENA,
    CASE WHEN CL.HC_CPF_CNPJ__C IS NOT NULL AND PAR.NAME = 'BB CORRETORA - 52' THEN 1 ELSE 0 END AS CLIENTE,
    CASE WHEN CL.HC_CPF_CNPJ__C IS NOT NULL AND CL.HC_CONSELHEIRO__C = 1 THEN 1 ELSE 0 END AS CONSELHEIRO,
	CASE WHEN ISNULL(A.CEP, '') = '' OR A.CEP = ' ' THEN 0 ELSE 1 END AS CEP_VALIDO
FROM Prospect_ComOTC_TMKT_Validacao_Base_2 A
INNER JOIN CAMPAIGN_SALESFORCE CA ON A.FORNECEDOR = CA.HC_FORNECEDOR__c
LEFT JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE CL ON RIGHT(REPLICATE ('0' , 15)+CONVERT(VARCHAR, A.CPF), 11) = CL.HC_CPF_CNPJ__C
LEFT JOIN HC_PARCEIRO__C_SALESFORCE PAR ON PAR.ID = CL.HC_PARCEIRO__C
LEFT JOIN TB_BASE_QUARENTENA Q ON RIGHT(REPLICATE ('0' , 15)+CONVERT(VARCHAR, A.CPF), 11) = Q.CPF_CNPJ
WHERE
    CA.HC_FORNECEDOR__C = 'TMKT'

AND CA.[TYPE] = 'Prospect'
AND CA.ParentId IS NOT NULL
AND CA.HC_VALIDA_RNA__C = 1
AND (

	(LEN(NULLIF(TEL_01, '')) < 10 AND NOT( LEN(TEL_01) = 8 AND TEL_01 LIKE '9%' ))
	OR (LEN(NULLIF(TEL_02, '')) < 10 AND NOT( LEN(TEL_02) = 8 AND TEL_02 LIKE '9%' ))
	OR (LEN(NULLIF(TEL_03, '')) < 10 AND NOT( LEN(TEL_03) = 8 AND TEL_03 LIKE '9%' ))
	OR (LEN(NULLIF(TEL_04, '')) < 10 AND NOT( LEN(TEL_04) = 8 AND TEL_04 LIKE '9%' ))
	OR (LEN(NULLIF(TEL_05, '')) < 10 AND NOT( LEN(TEL_05) = 8 AND TEL_05 LIKE '9%' ))
)

      AND CHARINDEX(' ', A.NOME) > 0