{
  "ssjsActivityId": "fafe83fb-7d91-45ae-9caa-6952094e52ce",
  "name": "Prospect_TMKT_Upsert_CampaignMember3",
  "key": "f630a5e9-dc8e-4e87-acff-b2c6af261473",
  "description": "Faz o upsert do CampaignMember com os dados da DE OTC291 Filtrado",
  "script": "<script runat=\"server\">\r\nPlatform(\"Core\", \"2.0\");\r\nvar api = new Script.Util.WSProxy();\r\nvar nameDE = 'Tb_Base_Prospect_OTC291_Filtrada_TMKT';\r\nvar idCampanha = '7016g000002O0CEAA0';\r\n\r\n// transforma o nome de um campo para 'Id', para ser enviado ao Serivce (caso não ocorra um update, deixar o campo em branco '')\r\nvar DEPARACAMPOID_SERVICE = 'Id_Membro_Campanha';\r\n\r\nvar DEPARACAMPOS = {\r\n  \"Id_Cliente_Parceiro\": \"HC_Cliente_x_Parceiro__c\",\r\n  \"Id_Contato\": \"ContactId\",\r\n  \"CPF\": \"HC_CPF_CNPJ__c\"\r\n}\r\n\r\n// Usar caso haja valores para inserir carimbados (que não são variáveis de acordo com a base)\r\nvar VALORESFIXOS = {\r\n  \"HC_DISPARO_CAMPANHA__c\": new Date(),\r\n  \"CampaignId\": idCampanha\r\n}\r\n\r\n// DE OTC291 filtrado\r\nvar campoIdNoDEParaAtualizar = 'Id_Membro_Campanha';\r\nvar campoPKNoDEParaAtualizar = 'CPF';\r\n\r\n// Formatar campos de data para formato YYYY-MM-DD\r\n// Usar lado direito no caso do objeto deparaCampos\r\nvar dateFieldsToFormat = [\r\n  'HC_DISPARO_CAMPANHA__c'\r\n];\r\n\r\n// Aplicar um filtro para trazer do DE apenas linhas desejadas\r\nvar applyFilterRetrieve = true; // flag para usar o filtro \"filterRetrieveRows\"\r\n// Campo para atualizar o DE informando que um contato já teve a tentativa de disparo\r\n// Para caso o Script precise ser executado novamente\r\nvar flagEnvioParaService = 'Envio_Service_MembroCampanha';\r\nvar filterRetrieveRows = {\r\n  LeftOperand:{\r\n    Property: flagEnvioParaService,\r\n    SimpleOperator: 'equals',\r\n    Value: false\r\n  },\r\n  LogicalOperator:\"AND\",\r\n  RightOperand:{\r\n    LeftOperand: {\r\n      Property: 'Row',\r\n      SimpleOperator: 'greaterThan', \r\n      Value: 150000\r\n    },\r\n    LogicalOperator:\"AND\",\r\n    RightOperand:{\r\n      Property: 'Envio_Service_ClienteParceiro',\r\n      SimpleOperator: 'equals', \r\n      Value: true\r\n    }\r\n  }\r\n}\r\n\r\neval(Platform.Function.TreatAsContent( Platform.Function.ContentBlockByID('60141') ));\r\n\r\n</script>",
  "categoryId": 38837,
  "createdDate": "2022-04-16T11:07:06.573",
  "modifiedDate": "2023-07-05T13:21:12.84"
}