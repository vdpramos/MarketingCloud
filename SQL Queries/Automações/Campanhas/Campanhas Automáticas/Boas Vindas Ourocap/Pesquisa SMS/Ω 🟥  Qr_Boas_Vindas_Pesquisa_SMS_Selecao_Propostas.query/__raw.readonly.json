{
  "queryDefinitionId": "2d1702ee-30f3-4e07-92d0-cc666cfbfdc7",
  "name": "Qr_Boas_Vindas_Pesquisa_SMS_Selecao_Propostas",
  "key": "e4ed4232-d071-4393-976a-20c65adacaac",
  "description": "",
  "queryText": "SELECT\n  B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n  C.NAME AS NOME,\n  CASE\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 1' THEN HC_CELULAR_1__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 2' THEN HC_CELULAR_2__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3' THEN HC_CELULAR_3__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3_3' THEN HC_CELULAR_3_3__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 4' THEN HC_CELULAR_4__C\n    WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n    WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n    WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n    WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN HC_CELULAR_3_3__C\n    WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN HC_CELULAR_4__C\n    ELSE NULL\n  END AS CELULAR,\n  CASE\n    WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN 1\n    ELSE 0\n  END AS CELULAR_VALIDO,\n  B.HC_NAO_DESEJA_RECEBER_SMS__C AS NAO_DESEJA_RECEBER_SMS,\n  A.ID AS ID_CAMPANHA, \n  B.ID AS ID_CLIENTE_PARCEIRO,\n  C.ID AS ID_CONTATO,\n  PROP.ID AS ID_PROPOSTA,\n  PROP.CREATEDDATE\nFROM CAMPAIGN_SALESFORCE A\nINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\nINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\nINNER JOIN HC_PROPOSTA__C_SALESFORCE PROP ON B.ID = PROP.HC_TITULAR__C\nLEFT JOIN BOAS_VINDAS_PESQUISA_SMS_HISTORICO HIST ON HIST.ID_PROPOSTA = PROP.ID\nWHERE\n  (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n  /* MOMENTO DE EXECUÇÃO DA CAMPANHA */\n /* AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n  AND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE()) */\n  AND A.ISACTIVE = 1\n  /* ID DA CAMPANHA PAI (HEADER) DE BOAS VINDAS OUROCAP */\n  AND A.ID = '7016g000000NVrcAAG'\n  /* NAO EXECUTAR PARA A MESMA PROPOSTA DUAS VEZES */\n  AND HIST.ID_PROPOSTA IS NULL\n  /* AND PROP.HC_SITUACAO__C NOT IN ('Cancelada pelo OTC', 'Cancelada') */\n  /* PARCEIRO TCBB PARA OUROCAP */\n  AND A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n  AND ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0\n  AND CONVERT(VARCHAR, DATEADD(DD, 2, PROP.CREATEDDATE), 101) = CONVERT(VARCHAR, GETDATE(), 101)\n  AND (\n    /* CUSTOM BETWEEN */\n    (A.HC_VALOR_MINIMO_DE_PARCELA__C IS NULL OR PROP.HC_VALOR__C > A.HC_VALOR_MINIMO_DE_PARCELA__C)\n    AND (A.HC_VALOR_MAXIMO_DA_PARCELA__C IS NULL OR PROP.HC_VALOR__C < A.HC_VALOR_MAXIMO_DA_PARCELA__C)\n  )\n  AND\n    /* Ter celular valido e deseja receber sms */\n    ( B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' \n    OR B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' ) \n    AND ISNULL(B.HC_NAO_DESEJA_RECEBER_SMS__C, 0) = 0",
  "targetName": "Tb_Boas_Vindas_Pesquisa_SMS",
  "targetKey": "5441ED26-86D7-4B47-BA59-DF24F79EC3F1",
  "targetId": "45551c84-c139-ed11-a5b6-d4f5ef66b08b",
  "targetDescription": "Publico Inicial - Propostas elegiveis para campanha",
  "createdDate": "2022-09-21T11:30:49.273",
  "modifiedDate": "2023-08-08T09:01:48.357",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 53495,
  "isFrozen": false
}