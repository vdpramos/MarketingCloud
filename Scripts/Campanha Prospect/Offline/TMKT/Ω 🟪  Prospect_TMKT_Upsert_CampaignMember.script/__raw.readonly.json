{
  "ssjsActivityId": "f49035ef-d969-4083-a359-a0bd2176ca82",
  "name": "Prospect_TMKT_Upsert_CampaignMember",
  "key": "930b3375-883e-4d9d-a1b8-f736c12fb24a",
  "description": "Faz o upsert do CampaignMember com os dados da DE OTC291 Filtrado",
  "script": "<script runat=\"server\">\nPlatform(\"Core\", \"2.0\");\nvar api = new Script.Util.WSProxy();\nvar nameDE = 'Tb_Base_Prospect_OTC291_Filtrada_TMKT';\nvar idCampanha = '7016g000002O0CEAA0';\n\n// transforma o nome de um campo para 'Id', para ser enviado ao Serivce (caso não ocorra um update, deixar o campo em branco '')\nvar DEPARACAMPOID_SERVICE = 'Id_Membro_Campanha';\n\nvar DEPARACAMPOS = {\n  \"Id_Cliente_Parceiro\": \"HC_Cliente_x_Parceiro__c\",\n  \"Id_Contato\": \"ContactId\",\n  \"CPF\": \"HC_CPF_CNPJ__c\"\n}\n\n// Usar caso haja valores para inserir carimbados (que não são variáveis de acordo com a base)\nvar VALORESFIXOS = {\n  \"HC_DISPARO_CAMPANHA__c\": new Date(),\n  \"CampaignId\": idCampanha\n}\n\n// DE OTC291 filtrado\nvar campoIdNoDEParaAtualizar = 'Id_Membro_Campanha';\nvar campoPKNoDEParaAtualizar = 'CPF';\n\n// Formatar campos de data para formato YYYY-MM-DD\n// Usar lado direito no caso do objeto deparaCampos\nvar dateFieldsToFormat = [\n  'HC_DISPARO_CAMPANHA__c'\n];\n\n// Aplicar um filtro para trazer do DE apenas linhas desejadas\nvar applyFilterRetrieve = true; // flag para usar o filtro \"filterRetrieveRows\"\n// Campo para atualizar o DE informando que um contato já teve a tentativa de disparo\n// Para caso o Script precise ser executado novamente\nvar flagEnvioParaService = 'Envio_Service_MembroCampanha';\nvar filterRetrieveRows = {\n  LeftOperand:{\n    Property: flagEnvioParaService,\n    SimpleOperator: 'equals',\n    Value: false\n  },\n  LogicalOperator:\"AND\",\n  RightOperand:{\n    LeftOperand: {\n      Property: 'Row',\n      SimpleOperator: 'lessThan', \n      Value: 75000\n    },\n    LogicalOperator:\"AND\",\n    RightOperand:{\n      Property: 'Envio_Service_ClienteParceiro',\n      SimpleOperator: 'equals', \n      Value: true\n    }\n  }\n}\n\neval(Platform.Function.TreatAsContent( Platform.Function.ContentBlockByID('60141') ));\n\n</script>",
  "categoryId": 38837,
  "createdDate": "2022-03-25T17:59:21.767",
  "modifiedDate": "2022-07-01T05:51:21.927"
}