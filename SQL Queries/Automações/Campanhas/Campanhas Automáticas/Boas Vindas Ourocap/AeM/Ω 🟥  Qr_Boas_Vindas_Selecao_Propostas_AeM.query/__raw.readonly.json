{
  "queryDefinitionId": "9587b89a-97a7-4260-a66a-653524b58df3",
  "name": "Qr_Boas_Vindas_Selecao_Propostas_AeM",
  "key": "e3594e82-0851-42ea-b9f5-d1776fe99cbd",
  "description": "Seleciona publico inicial com base nas propostas para comunicacao de boas vindas",
  "queryText": "SELECT  \n  B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n  C.NAME AS NOME,\n  CASE\n    WHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n    WHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n    WHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n    WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n    WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n    WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n    ELSE NULL\n  END AS EMAIL,\n  CASE\n    WHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\n    WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n    WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n    WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n    ELSE 0\n  END AS EMAIL_VALIDO,\n  CASE\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 1' THEN HC_CELULAR_1__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 2' THEN HC_CELULAR_2__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3' THEN HC_CELULAR_3__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 3_3' THEN HC_CELULAR_3_3__C\n    WHEN B.HC_TELEFONE_PRINCIPAL__C = 'CELULAR 4' THEN HC_CELULAR_4__C\n    WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n    WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n    WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n    WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN HC_CELULAR_3_3__C\n    WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN HC_CELULAR_4__C\n    ELSE NULL\n  END AS CELULAR,\n  CASE\n    WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN 1\n    WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN 1\n    ELSE 0\n  END AS CELULAR_VALIDO,\n  B.HC_NAO_DESEJA_RECEBER_SMS__C AS NAO_DESEJA_RECEBER_SMS,\n  B.HC_NAO_DESEJA_RECEBER_EMAIL__C AS NAO_DESEJA_RECEBER_EMAIL,\n  A.ID AS ID_CAMPANHA, \n  B.ID AS ID_CLIENTE_PARCEIRO,\n  C.ID AS ID_CONTATO,\n  PROP.ID AS ID_PROPOSTA,\n  PROP.CREATEDDATE\nFROM CAMPAIGN_SALESFORCE A\nINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\nINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\nINNER JOIN HC_PROPOSTA__C_SALESFORCE PROP ON B.ID = PROP.HC_TITULAR__C\nLEFT JOIN AeM_Boas_Vindas_Historico_Propostas HIST ON HIST.ID_PROPOSTA = PROP.ID\nWHERE\n  (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n  /* DATA DE EXECUCAO DA CAMPANHA */\n  AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n  /* HORA DE EXECUCAO DA CAMPANHA */\n  AND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE())\n  \n  AND A.ISACTIVE = 1\n  /* ID DA CAMPANHA PAI (HEADER) DE BOAS VINDAS OUROCAP */\n  AND A.PARENTID = '7016g000000NVrXAAW'\n  /* NAO EXECUTAR PARA A MESMA PROPOSTA DUAS VEZES */\n  AND HIST.ID_PROPOSTA IS NULL\n  /* AND PROP.HC_SITUACAO__C NOT IN ('Cancelada pelo OTC', 'Cancelada') */\n  /* PARCEIRO TCBB PARA OUROCAP */\n  AND A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n  AND ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0\n  AND PROP.CREATEDDATE BETWEEN A.HC_DATA_INICIAL_DE_COMPRA__C AND A.HC_DATA_FINAL_DE_COMPRA__C\n  AND (\n    /* CUSTOM BETWEEN */\n    (A.HC_VALOR_MINIMO_DE_PARCELA__C IS NULL OR PROP.HC_VALOR__C > A.HC_VALOR_MINIMO_DE_PARCELA__C)\n    AND (A.HC_VALOR_MAXIMO_DA_PARCELA__C IS NULL OR PROP.HC_VALOR__C < A.HC_VALOR_MAXIMO_DA_PARCELA__C)\n  )\n  /* PRECISA TER UM CANAL VALIDO PARA RECEBER A COMUNICAÇÃO */\n  AND (\n    /* Ter e-mail valido e deseja receber e-mail*/\n    (( B.HC_EMAIL_BRASILCAP__C IS NOT NULL OR B.HC_EMAIL_COMERCIAL__C IS NOT NULL OR B.HC_EMAIL_PESSOAL__C IS NOT NULL ) AND ISNULL(B.HC_NAO_DESEJA_RECEBER_EMAIL__C, 0) = 0 )\n    /* ou celular valido e deseja receber sms */\n    OR (\n        ( B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' \n        OR B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' ) \n      AND ISNULL(B.HC_NAO_DESEJA_RECEBER_SMS__C, 0) = 0 )\n  )",
  "targetName": "AeM_Tb_Boas_Vindas_Ourocap_Prospostas",
  "targetKey": "4C6832B7-23E5-46FF-B283-32F1EA268620",
  "targetId": "7553b3cb-bb50-ed11-a5b6-d4f5ef66b08b",
  "targetDescription": "Publico Inicial - Propostas elegiveis para campanha",
  "createdDate": "2022-10-21T12:00:31.47",
  "modifiedDate": "2023-08-18T10:02:59.673",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 54649,
  "isFrozen": false
}