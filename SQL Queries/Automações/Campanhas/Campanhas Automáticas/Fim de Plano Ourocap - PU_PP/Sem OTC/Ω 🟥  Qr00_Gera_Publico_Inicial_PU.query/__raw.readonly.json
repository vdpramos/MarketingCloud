{
  "queryDefinitionId": "91559bea-547b-46c1-b347-ebafa53adbb5",
  "name": "Qr00_Gera_Publico_Inicial_PU",
  "key": "9442b612-1b2a-43d7-bbd2-9c08908601a6",
  "description": "",
  "queryText": "SELECT\n\tbase.*\nFROM (\n\tSELECT DISTINCT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\tREPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(C.NAME,'á','A'),'à','A'),'â','A'),'ã','A'),'ä','A'),'é','E'),'è','E'),'ê','E'),'ë','E'),'í','I'),'ì','I'),'î','I'),'ï','I'),'ó','O'),'ò','O'),'ô','O'),'õ','O'),'ö','O'),'ú','U'),'ù','U'),'û','U'),'ü','U') AS NOME,\n\t\tB.HC_IDADE__C AS IDADE,\n\t\tB.HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\n\t\tB.HC_GENERO_DO_CLIENTE__C AS SEXO,\n\t\tB.HC_PARCEIRO__C AS PARCEIRO,\n\t\tB.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n\t\tB.HC_NAO_DESEJA_RECEBER_SMS__C AS NAO_DESEJA_RECEBER_SMS,\n\t\tB.HC_NAO_DESEJA_RECEBER_EMAIL__C AS NAO_DESEJA_RECEBER_EMAIL,\n\t\td.HC_renovacao_automatica__c,\n\t\tCASE\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 1' THEN B.HC_CELULAR_1__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 2' THEN B.HC_CELULAR_2__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 3' THEN B.HC_CELULAR_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 3_3' THEN B.HC_CELULAR_3_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 4' THEN B.HC_CELULAR_4__C\n      WHEN B.HC_STATUS_CELULAR_1__C IS NOT NULL THEN B.HC_CELULAR_1__C\n      WHEN B.HC_STATUS_CELULAR_2__C IS NOT NULL THEN B.HC_CELULAR_2__C\n      WHEN B.HC_STATUS_CELULAR_3__C IS NOT NULL THEN B.HC_CELULAR_3__C\n      WHEN B.HC_STATUS_CELULAR_3_3__C IS NOT NULL THEN B.HC_CELULAR_3_3__C\n      WHEN B.HC_STATUS_CELULAR_4__C IS NOT NULL THEN B.HC_CELULAR_4__C\n      ELSE NULL\n    END AS CELULAR,\n    CASE\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN 1\n      ELSE 0\n    END AS CELULAR_VALIDO,\n\t\tA.STARTDATE AS DT_INICIO_MAILING,\n\t\tA.ENDDATE AS DT_FIM_MAILING,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n\t\t\tELSE NULL\n\t\tEND AS EMAIL,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n\t\t\tELSE 0\n\t\tEND AS EMAIL_VALIDO,\n\t\tB.HC_CPF_CNPJ__C AS ID,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n        D.ID AS TITULO_ID,\n\t\tDATEADD(DAY, A.HC_PROXIMA_EXECUCAO__C,A.HC_DATA_DE_EXECUCAO__C) AS DATA_PROXIMA_EXECUCAO,\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\n\tFROM (\n\t\tSELECT\n\t\t\t  A.ID AS CAMPAIGN_ID,\n\t\t\t  B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\n\t\t\t  C.ID AS CONTACT_ID,\n\t\t\t  D.ID AS TITULO_ID,\n\t\t\t  ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\n\t\t\tFROM CAMPAIGN_SALESFORCE A\n\t\t\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n\t\t\tINNER JOIN Contact_Salesforce C ON C.HC_CPF_CNPJ__c = B.HC_CPF_CNPJ__c\n\t\t\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID\n\t\t\tLEFT JOIN [FIM_PLANO_PU_SEMOTC_HISTORICO] H ON H.TITULO_ID = D.ID\n\t\t\tWHERE\n\t\t\t\tA.Id = '7016g00000075QNAAY'\n\t\t\tAND A.ISACTIVE = 1\n      AND (A.HC_PARCEIRO__C = B.HC_PARCEIRO__C OR A.HC_PARCEIRO__C IS NULL)\n\t\t\tAND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n\t\t\t\t\tAND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE())\n\t\t\tAND D.HC_Fim_previsto__c BETWEEN HC_Data_inicial_do_periodo_de_resgate__c AND HC_Data_fim_do_periodo_de_resgate__c\n\t\t\t\t/* Não repetição de comunicação para titulo já comunicado */\n\t\t\tAND H.TITULO_ID IS NULL\n\t\t\tAND D.HC_SITUACAO__C IN ('Em processo de finalização', 'Finalizado - Fim de plano')\n\t\t\tAND D.HC_TIPO_DE_PAGAMENTO__C = ('PU')\n\t\t\tAND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n\t\t\tAND B.HC_CLASSIFICACAO__C = 'Cliente'\n\t\t\tAND B.HC_Idade__c BETWEEN 18 AND 70\n\t\t\tAND B.HC_PEP__C = 0\n\t\t\tAND B.HC_CONSELHEIRO__C = 0\n\t\t\t/* AND (ISNULL(B.HC_NAO_IMPORTUNE__C, 0) = 0 OR A.HC_VALIDA_NAO_IMPORTUNE__C = 0) */\n\t\t\tAND ( ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0)\n            AND (\n                    /* Pode receber e-mail */\n                ( ISNULL(B.HC_NAO_DESEJA_RECEBER_EMAIL__C, 0) = 0 AND ( B.HC_EMAIL_BRASILCAP__C IS NOT NULL OR B.HC_EMAIL_COMERCIAL__C IS NOT NULL OR B.HC_EMAIL_PESSOAL__C IS NOT NULL ) )\n                    /* ou pode receber sms */\n                OR ( ISNULL(B.HC_NAO_DESEJA_RECEBER_SMS__C, 0) = 0 AND (B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' \n                    OR B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_4__C = 'VÁLIDO') )\n            )\n        ) FILTERED\n\tINNER JOIN CAMPAIGN_SALESFORCE A ON A.ID = FILTERED.CAMPAIGN_ID\n\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\n\tINNER JOIN CONTACT_SALESFORCE C ON C.ID = FILTERED.CONTACT_ID\n\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.ID = FILTERED.TITULO_ID\n\tWHERE FILTERED.NUMBER_OF_CPF_REPETITION = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP \n  ON BASE.ID_CAMPANHA = CAMP.ID",
  "targetName": "Fim_Plano_PU_semOTC_Publico_Inicial",
  "targetKey": "021E8A92-529E-4EDF-B839-19F31A0F37E9",
  "targetId": "37cea96d-ac6c-ec11-a311-48df370eabe5",
  "targetDescription": "",
  "createdDate": "2022-01-03T16:00:10.8",
  "modifiedDate": "2022-09-25T12:23:12.223",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 43885,
  "isFrozen": false
}