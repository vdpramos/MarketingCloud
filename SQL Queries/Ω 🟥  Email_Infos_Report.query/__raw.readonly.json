{
  "queryDefinitionId": "3ca11d60-1dc6-4f27-ab11-0607f0aad8a2",
  "name": "Email_Infos_Report",
  "key": "083ca5ac-ea9e-4dc6-b43b-a8049f8ec52c",
  "description": "Infos de envios de Email dos ultimos 7 dias, a partir da data do sistema",
  "queryText": "SELECT DISTINCT st.CPF AS CPF, \r\nformat(st.Data_Nascimento,'dd/MM/yyyy') AS DT_NASCIMENTO,\r\nIIF(u.SubscriberKey=st.SubscriberKey, 1, 0) AS OPTOUT, \r\nCASE WHEN j.EmailName = 'Boas Vindas Caracterisitcas Novo' THEN 'Boas Vindas Características Novo'\r\n    WHEN j.EmailName = 'Boas Vindas Caracterisitcas Recorrente' THEN 'Boas Vindas Características Recorrente'\r\n    WHEN j.EmailName = 'Boas Vindas Caracterisitcas Recuperado' THEN 'Boas Vindas Características Recuperado'\r\n    WHEN j.EmailName = 'Fim de Plano PM sem OTC - sem Renovação' THEN 'Fim de Plano PM - sem Renovação'\r\n    WHEN j.EmailName = 'Fim de Plano PM sem OTC - com Renovação' THEN 'Fim de Plano PM - com Renovação'\r\n    WHEN j.EmailName = 'Email Campanha Aniversario - 20212212' THEN 'Campanha Aniversario'\r\n    ELSE j.EmailName END AS CAMPANHA,\r\nREPLACE(j.EmailSubject, ',', '') AS Subject,\r\nMIN(format(st.EventDate, 'dd/MM/yyyy')) AS DT_Envio,\r\nMIN(format(st.EventDate, 'dd/MM/yyyy hh:mm:ss')) AS DT_Entrega, \r\nIIF(b.JobID=st.JobID, 1, 0) AS Bounce, \r\nIIF(st.JobID=b.JobID,0,1) AS ENTREGUE, \r\nIIF(c.JobID=st.JobID, 1,0) AS Clique, \r\nIIF(o.JobID=st.JobID, 1, 0) AS Abertura, \r\nIIF((cr.Qtde_Clicks IS NULL), 0, cr.Qtde_Clicks) AS QT_CLIQUE,\r\nMIN(format(o.EventDate, 'dd/MM/yyyy hh:mm:ss')) AS DT_Abertura,\r\nCASE WHEN j.EmailName IN   ('Boas Vindas Caracterisitcas Novo',\r\n                        'Boas Vindas Caracterisitcas Recorrente', \r\n                        'Boas Vindas Caracterisitcas Recuperado',\r\n                        'Boas Vindas Caracteristicas Novo',\r\n                        'Boas Vindas Caracteristicas Recorrente', \r\n                        'Boas Vindas Caracteristicas Recuperado',\r\n                        'Email Campanha Aniversario - 20212212',\r\n                        'Email Final de Ano - 20212212',\r\n                        'Campanha_FimdeAno2021',\r\n                        'Periodico de Sorteio',\r\n                        'CAMPANHA_AUTOMATICA_SORTEIO_PERIODICO') THEN\t'Relacionamento'\r\n    WHEN j.EmailName IN    ('Boas Vindas Novo',\r\n                        'Boas Vindas Recorrente',\r\n                        'Boas Vindas Recuperado') THEN 'Boas Vindas'\r\n    WHEN j.EmailName IN    ('Fim de Plano PM - com Renovação',\r\n                        'Fim de Plano PM - sem Renovação',\r\n                        'Fim de Plano PM sem OTC - sem Renovação', \r\n                        'Fim de Plano PM sem OTC - com Renovação') THEN 'Fim de plano/ Renovação'\r\n    ELSE NULL END AS Jornada\r\nFROM ACCOUNT_SENT_INFOS st\r\nLEFT JOIN UNSUBSCRIBE_INFOS u\r\nON st.SubscriberKey=u.SubscriberKey\r\nJOIN JOB_INFOS j\r\nON st.JobID=j.JobID\r\nLEFT JOIN BOUNCE_INFOS b\r\nON st.JobID=b.JobID AND st.SubscriberKey=b.SubscriberKey\r\nLEFT JOIN CLICK_INFOS c\r\nON st.JobID=c.JobID AND st.SubscriberKey=c.SubscriberKey\r\nLEFT JOIN OPEN_INFOS o\r\nON st.JobID = o.JobID AND st.SubscriberKey=o.SubscriberKey\r\nLEFT JOIN CLICKS_INFOS_REPORT cr\r\nON st.SubscriberKey=cr.SubscriberKey AND st.JobID=cr.JobID\r\nGROUP BY st.CPF, st.Data_Nascimento, IIF(u.SubscriberKey=st.SubscriberKey, 1, 0),\r\nj.EmailSubject, j.EmailName, IIF(st.EventDate IS NOT NULL, 1, 0),\r\nIIF(b.JobID=st.JobID, 1, 0), IIF(c.JobID=st.JobID, 1,0), IIF(o.JobID=st.JobID, 1, 0),\r\ncr.Qtde_Clicks, st.JobID, b.JobID\r\nORDER BY DT_Envio\r\nOFFSET 0 ROWS\r\n\r\n",
  "targetName": "EMAIL_INFOS_REPORT_7DIAS_v2",
  "targetKey": "6C104F78-7953-44C3-9403-22AF6E807BCA",
  "targetId": "4b5285cf-0b89-ec11-a317-48df37342c99",
  "targetDescription": "Relatorio dos Emails enviados nos ultimos 7 dias",
  "createdDate": "2022-01-20T05:19:43.297",
  "modifiedDate": "2023-02-13T09:23:18.56",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 1930,
  "isFrozen": false
}