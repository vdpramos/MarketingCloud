{
  "queryDefinitionId": "2580e9fd-23e8-4068-a722-a96192a6629a",
  "name": "20220201_teste_contemplacao",
  "key": "7ebadf7f-f17d-408a-a23b-9f698013c866",
  "description": "",
  "queryText": "SELECT DISTINCT\r\n  C.NAME AS NOME,\r\n  B.HC_CPF_CNPJ__C AS CPF_CNPJ,\r\n  B.HC_IDADE__C AS IDADE,\r\n\tB.HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\r\n\tB.HC_GENERO_DO_CLIENTE__C AS SEXO,\r\n\tB.HC_PARCEIRO__C AS PARCEIRO,\r\n\tB.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\r\n\t\t\tCASE\r\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\r\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\r\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\r\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\r\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\r\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\r\n\t\t\tELSE NULL\r\n\t\tEND AS EMAIL,\r\n\t\tCASE\r\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\r\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\r\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\r\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\r\n\t\t\tELSE 0\r\n\t\tEND AS EMAIL_VALIDO,\r\n\t\t\t\tCASE\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\r\n\t\t\tELSE NULL\r\n\t\tEND AS CELULAR,\r\n\t\tCASE\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\r\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\r\n\t\t\tELSE 0\r\n\t\tEND AS CELULAR_VALIDO,\r\n\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\r\n\t'FIXO' AS TIPO_TEL_01,\r\n\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\r\n\t'FIXO' AS TIPO_TEL_02,\r\n\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\r\n\t'FIXO' AS TIPO_TEL_03,\r\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\r\n\t'MÓVEL' AS TIPO_TEL_04,\r\n\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\r\n\t'MÓVEL' AS TIPO_TEL_05,\r\n\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\r\n\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\r\n\t'MÓVEL' AS TIPO_TEL_06,\r\n\tB.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\r\n\tB.HC_CLASSIFICACAO__C AS PUBLICO_ALVO,\r\n\tA.[TYPE] AS TIPO_CAMPANHA,\r\n\tA.STARTDATE AS DT_INICIO_MAILING,\r\n\tA.ENDDATE AS DT_FIM_MAILING,\r\n\tA.HC_VALIDA_ALTA_RENDA__C AS CAMPANHA_VALIDA_ENCARTEIRAMENTO,\r\n    A.HC_VALIDA_NAO_IMPORTUNE__C AS CAMPANHA_NAO_IMPORTUNE,\r\n    A.HC_VALIDA_RNA__C AS CAMPANHA_VALIDA_RNA,\r\n\tA.HC_PRODUTO__C AS ID_PRODUTO,\r\n    A.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\r\n\tB.HC_CPF_CNPJ__C AS ID,\r\n\tA.ID AS ID_CAMPANHA, \r\n\tB.ID AS ID_CLIENTE_PARCEIRO,\r\n\tB.HC_CLIENTE__C AS ID_CLIENTE,\r\n\tB.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\r\n    D.HC_Data_Inicio_Sorteio__c AS DT_INICIO_SORTEIO,\r\n    A.HC_Valor_maximo_de_contemplacao__c AS Valor_Max_Contemplacao,\r\n    A.HC_Valor_minimo_de_contemplacao__c AS Valor_Min_Contemplacao,\r\n    A.HC_Data_inicial_de_contemplacao__c AS Dt_Inicio_Contemplacao,\r\n    A.HC_Data_fim_de_contemplacao__c AS Dt_Fim_Contemplacao,\r\n    format (D.HC_Data_da_Ultima_Contemplacao__c,'MM/dd/yyyy') AS Dt_Ultima_Contemplacao, \r\n    D.HC_Numero_da_Sorte__c AS Numero_Sorteado,\r\n    D.HC_Valor_Premio__c AS Valor_Premio,\r\n\tCASE WHEN DATEPART(WEEKDAY, GetDate()) = 6 THEN DATEADD(DAY, 3, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) ELSE DATEADD(DAY, A.HC_PROXIMA_EXECUCAO__C, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) END AS DATA_PROXIMA_EXECUCAO\r\nFROM CAMPAIGN_SALESFORCE A\r\nINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\r\nINNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID \r\nINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C AND C.NAME=D.HC_NOME_DO_TITULAR__C\r\nWHERE\r\nC.HC_Tipo_de_Relacionamento__c='Cliente' AND\r\n     UPPER(A.[TYPE]) = 'AUTOMÁTICO'\r\n/*AND A.ID = '7016g000000NVYrAAO'*/\r\nAND D.HC_Data_da_Ultima_Contemplacao__c BETWEEN A.HC_Data_inicial_de_contemplacao__c AND A.HC_Data_fim_de_contemplacao__c",
  "targetName": "Tb_Base_Contemplacao_Ourocap_teste",
  "targetKey": "EAADBB71-C6C3-4E16-B781-0017B725DB1A",
  "targetId": "9691f8b5-4e83-ec11-a317-48df37342c99",
  "targetDescription": "",
  "createdDate": "2022-02-01T05:42:49.83",
  "modifiedDate": "2022-02-01T06:56:35.09",
  "targetUpdateTypeId": 1,
  "targetUpdateTypeName": "Update",
  "categoryId": 1930,
  "isFrozen": false
}