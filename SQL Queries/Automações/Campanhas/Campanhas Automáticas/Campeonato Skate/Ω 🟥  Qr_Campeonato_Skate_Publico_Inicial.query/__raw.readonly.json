{
  "queryDefinitionId": "1271c5a1-187b-42d9-bec2-21718f69916d",
  "name": "Qr_Campeonato_Skate_Publico_Inicial",
  "key": "b5b718b6-fffe-4eaf-a73e-a6cdffdf5d53",
  "description": "Gera o Public Inicial para receber as comunicacoes da campanha",
  "queryText": "SELECT\n  BASE.*\nFROM (\n  SELECT\n    B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n    replace( replace( replace( replace( replace( replace( replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (C.NAME, 'á', 'a'),'é', 'e'),'í', 'i'),'ó', 'o'),'ú', 'u'),'Á', 'A'),'É', 'E'),'Í', 'I'),'Ó', 'O'),'Ú', 'U'),'à', 'a'),'À', 'A'),'ã', 'a'),'õ', 'o'),'Ã', 'A'),  'Õ', 'O'),'â', 'a'),'ê', 'e'),'ô', 'o'),'Â', 'A'),'Ê', 'E'),'Ô', 'O'),'ç', 'c'),'Ç', 'c') , '-', '') , '+', '') , '|', '') , '$', '') , '%', '') , '&', '') AS NOME,\n    CASE\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n      WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n      ELSE NULL\n    END AS EMAIL,\n    A.ID AS ID_CAMPANHA, \n    B.ID AS ID_CLIENTE_PARCEIRO,\n    C.ID AS ID_CONTATO,\n    row_number() over (PARTITION BY B.ID ORDER BY B.ID) AS ROWNO\n  FROM (\n    SELECT\n      A.ID as CAMPAIGNID,\n      B.ID AS CLIENTEPARCEIROID,\n      C.ID AS CONTACTID,\n      row_number() over (PARTITION BY B.ID ORDER BY B.ID) AS ROW\n    FROM CAMPAIGN_SALESFORCE A\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n    INNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\n    WHERE\n      A.PARENTID = '7016g000000Nd12AAC'\n      AND A.ISACTIVE = 1\n      /* Momento de execução da campanha */\n      AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n        AND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE())\n      AND (A.HC_PARCEIRO__C = B.HC_PARCEIRO__C OR A.HC_PARCEIRO__C IS NULL)\n      AND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n      AND B.HC_CLASSIFICACAO__C = 'Cliente'\n      AND ISNULL(B.HC_PEP__C, 0) = 0\n      AND ISNULL(B.HC_CONSELHEIRO__C, 0) = 0\n      AND B.HC_IDADE__C BETWEEN 18 AND 70\n      AND B.HC_PARCEIRO__C = 'a0W6g000006R0MfEAK'\n      AND (\n        B.HC_EMAIL_BRASILCAP__C IS NOT NULL OR B.HC_EMAIL_COMERCIAL__C IS NOT NULL OR B.HC_EMAIL_PESSOAL__C IS NOT NULL\n      )\n  ) SELECTED\n  INNER JOIN CAMPAIGN_SALESFORCE A ON SELECTED.CAMPAIGNID = A.ID\n  INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON SELECTED.CLIENTEPARCEIROID = B.ID\n  INNER JOIN CONTACT_SALESFORCE C ON SELECTED.CONTACTID = C.ID\n  WHERE SELECTED.ROW = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP\n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= (CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C)",
  "targetName": "Tb_CampeonatoSkate_Publico_Inicial",
  "targetKey": "8EDF3A2A-A0B1-411D-B1DB-D4B605B55317",
  "targetId": "5e922d3c-2e2b-ed11-a5b6-d4f5ef66b08b",
  "targetDescription": "Base contendo o publico Inicial acumulado",
  "createdDate": "2022-09-02T20:39:33.68",
  "modifiedDate": "2022-09-04T17:29:27.11",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 52821,
  "isFrozen": false
}