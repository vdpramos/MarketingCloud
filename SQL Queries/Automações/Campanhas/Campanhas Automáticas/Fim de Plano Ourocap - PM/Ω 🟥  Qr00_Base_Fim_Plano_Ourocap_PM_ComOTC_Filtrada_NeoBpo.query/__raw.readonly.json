{
  "queryDefinitionId": "5df7e2c1-959e-4279-aaa8-769a73458b98",
  "name": "Qr00_Base_Fim_Plano_Ourocap_PM_ComOTC_Filtrada_NeoBpo",
  "key": "99cdfe30-abae-4984-99b9-62b0992e3474",
  "description": "",
  "queryText": "SELECT\n\tbase.*\nFROM (\n\tSELECT DISTINCT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\tREPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(C.NAME,'á','A'),'à','A'),'â','A'),'ã','A'),'ä','A'),'é','E'),'è','E'),'ê','E'),'ë','E'),'í','I'),'ì','I'),'î','I'),'ï','I'),'ó','O'),'ò','O'),'ô','O'),'õ','O'),'ö','O'),'ú','U'),'ù','U'),'û','U'),'ü','U') AS NOME,\n\t\tB.HC_IDADE__C AS IDADE,\n\t\tB.HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\n\t\tB.HC_GENERO_DO_CLIENTE__C AS SEXO,\n\t\tB.HC_PARCEIRO__C AS PARCEIRO,\n\t\tB.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n\t\tB.HC_NAO_DESEJA_RECEBER_SMS__C AS NAO_DESEJA_RECEBER_SMS,\n\t\tB.HC_NAO_DESEJA_RECEBER_EMAIL__C AS NAO_DESEJA_RECEBER_EMAIL,\n\t\tCASE\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n\t\t\tELSE NULL\n\t\tEND AS CELULAR,\n\t\tCASE\n\t\t\tWHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n\t\t\tWHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n\t\t\tWHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n\t\t\tELSE 0\n\t\tEND AS CELULAR_VALIDO,\n\t\tA.STARTDATE AS DT_INICIO_MAILING,\n\t\tA.ENDDATE AS DT_FIM_MAILING,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n\t\t\tELSE NULL\n\t\tEND AS EMAIL,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n\t\t\tELSE 0\n\t\tEND AS EMAIL_VALIDO,\n\t\tB.HC_CPF_CNPJ__C AS ID,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n\t\tA.HC_EXCLUSAO_DE_COMPRA_RECENTE__C AS MESES_COMPRA_EXCLUSAO,\n\t\tA.HC_QUARENTENA__C AS MESES_QUARENTENA_EXCLUSAO,\n\t\tDATEADD(DAY, A.HC_PROXIMA_EXECUCAO__C,A.HC_DATA_DE_EXECUCAO__C) AS DATA_PROXIMA_EXECUCAO,\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\n\tFROM (\n\t\tSELECT\n\t\t\t  A.ID AS CAMPAIGN_ID,\n\t\t\t  B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\n\t\t\t  C.ID AS CONTACT_ID,\n\t\t\t  D.ID AS TITULO_ID,\n\t\t\t  ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\n\t\t\tFROM CAMPAIGN_SALESFORCE A\n\t\t\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n\t\t\tINNER JOIN Contact_Salesforce C ON C.HC_CPF_CNPJ__c = B.HC_CPF_CNPJ__c\n\t\t\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID\n\t\t\tWHERE\n\t\t\t\tUPPER(A.[TYPE]) = 'AUTOMÁTICO'\n\t\t\tAND A.Id = '7016g0000007094AAA'\n\t\t\tAND A.HC_VALIDA_RNA__C = 1\n\t\t\tAND B.HC_Id_Parceiro_Cap__c = 'TCBB'\n\t\t\tAND CONVERT(VARCHAR, A.HC_DATA_DE_EXECUCAO__C, 112) = CONVERT(VARCHAR, GETDATE(), 112)\n\t\t\tAND A.ISACTIVE = 1\n\t\t\tAND CONVERT(VARCHAR(10), D.HC_Fim_previsto__c, 120) BETWEEN CONVERT(VARCHAR(10), A.HC_DATA_INICIAL_DO_PERIODO_DE_RESGATE__C, 120) AND CONVERT(VARCHAR(10), A.HC_DATA_FIM_DO_PERIODO_DE_RESGATE__C, 120) \n\t\t\tAND D.HC_SITUACAO__C LIKE '%Fim de plano%'\n\t\t\tAND D.HC_TIPO_DE_PAGAMENTO__C = ('PM')\n\t\t\tAND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF')\n\t\t\tAND B.HC_Classificacao__c != 'Falecido'\n\t\t\tAND B.HC_Idade__c BETWEEN 18 AND 70\n\t\t\tAND ( ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0)\n\t  ) FILTERED\n\t\n\tINNER JOIN CAMPAIGN_SALESFORCE A ON A.ID = FILTERED.CAMPAIGN_ID\n\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\n\tINNER JOIN CONTACT_SALESFORCE C ON C.ID = FILTERED.CONTACT_ID\n\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.ID = FILTERED.TITULO_ID\n\tWHERE FILTERED.NUMBER_OF_CPF_REPETITION = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP \n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C\n",
  "targetName": "Tb_Base_Fim_Plano_Ourocap_PM_ComOTC_NeoBpo",
  "targetKey": "5A7B550C-4392-49A8-81F9-51A0DBE2BA26",
  "targetId": "afea19a4-ee1f-ec11-a30b-48df370eabe4",
  "targetDescription": "",
  "createdDate": "2021-05-03T15:31:52.887",
  "modifiedDate": "2021-12-30T13:32:52.007",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 33760,
  "isFrozen": false
}