{
  "queryDefinitionId": "1783719a-03ca-4c74-a648-681662870cda",
  "name": "Qr00_Base_Aniversariantes_Publico_Inicial",
  "key": "dea9ede3-d0e4-40bf-9666-23eef0fb9dcf",
  "description": "",
  "queryText": "SELECT\n  SELECTED.*\nFROM (\n  SELECT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\tC.NAME AS NOME,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n\t\t\tELSE NULL\n\t\tEND AS EMAIL,\n\t\tCASE\n\t\t\tWHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n\t\t\tWHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n\t\t\tELSE 0\n\t\tEND AS EMAIL_VALIDO,\n\t\tCASE\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n      WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN HC_CELULAR_3_3__C\n      WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN HC_CELULAR_4__C\n      ELSE NULL\n\t\tEND AS CELULAR,\n    CASE\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_4__C = 'VÁLIDO' THEN 1\n      ELSE 0\n    END AS CELULAR_VALIDO,\n\t\tB.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n\t\tB.HC_CPF_CNPJ__C AS ID,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n    AC.HC_DATA_NASCIMENTO__C,\n    B.HC_NAO_DESEJA_RECEBER_EMAIL__C AS NAO_DESEJA_RECEBER_EMAIL,\n    B.HC_NAO_DESEJA_RECEBER_SMS__C AS NAO_DESEJA_RECEBER_SMS,\n    GETDATE()+1 AS DATA_EXECUCAO,\n    ROW_NUMBER() OVER (PARTITION BY AC.ID ORDER BY AC.ID) AS ROW\n\tFROM CAMPAIGN_SALESFORCE A\n\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n\tINNER JOIN ACCOUNT_SALESFORCE AC ON AC.ID = B.HC_CLIENTE__C\n\tINNER JOIN CONTACT_SALESFORCE C ON C.ACCOUNTID = AC.ID\n\tWHERE A.ID = '7016g000000744GAAQ'\n    AND A.ISACTIVE = 1\n    /* Data de Execução \n    AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)\n    AND DATEPART(HH, A.HC_DATA_DE_EXECUCAO__C) = DATEPART(HH, GETDATE())\n    Tipo de cliente controlado pela campanha */\n    AND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR (A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ' ))\n    AND (A.HC_PARCEIRO__C = B.HC_PARCEIRO__C OR A.HC_PARCEIRO__C IS NULL)\n    AND B.HC_CLASSIFICACAO__C = 'CLIENTE'\n    AND B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C = 0\n    AND (ISNULL(B.HC_NAO_IMPORTUNE__C, 0) = 0 OR A.HC_VALIDA_NAO_IMPORTUNE__C = 0)\n    AND (\n        /* Pode receber e-mail */\n        ( ISNULL(B.HC_NAO_DESEJA_RECEBER_EMAIL__C, 0) = 0 AND ( B.HC_EMAIL_BRASILCAP__C IS NOT NULL OR B.HC_EMAIL_COMERCIAL__C IS NOT NULL OR B.HC_EMAIL_PESSOAL__C IS NOT NULL ) )\n        /* ou pode receber sms */\n        OR ( ISNULL(B.HC_NAO_DESEJA_RECEBER_SMS__C, 0) = 0 AND (B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' \n          OR B.HC_STATUS_CELULAR_3_3__C = 'VÁLIDO' OR B.HC_STATUS_CELULAR_4__C = 'VÁLIDO') )\n      )\n    AND RIGHT(CONVERT(CHAR(10),AC.HC_DATA_NASCIMENTO__C,23), 5) = RIGHT(CONVERT(CHAR(10),GETDATE(),23), 5)\n) SELECTED\nINNER JOIN CAMPAIGN_SALESFORCE A ON SELECTED.ID_CAMPANHA = A.ID\nINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON SELECTED.ID_CLIENTE_PARCEIRO = B.ID\nINNER JOIN CONTACT_SALESFORCE C ON SELECTED.ID_CONTATO = C.ID\nWHERE SELECTED.ROW = 1",
  "targetName": "Tb_Campanha_Aniversariantes_Base",
  "targetKey": "9E854E75-9577-4C9B-B053-58DEE287AB99",
  "targetId": "69d4ceb4-c953-ec11-a313-48df37342c99",
  "targetDescription": "Base com o publico inicial",
  "createdDate": "2021-12-02T17:52:49.157",
  "modifiedDate": "2022-12-15T09:24:17.677",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 42259,
  "isFrozen": false
}