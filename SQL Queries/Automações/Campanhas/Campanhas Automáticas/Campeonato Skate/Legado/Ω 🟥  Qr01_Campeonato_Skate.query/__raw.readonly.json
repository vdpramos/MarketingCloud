{
  "queryDefinitionId": "17dd60dc-7870-4b45-ba25-d98780cb4a00",
  "name": "Qr01_Campeonato_Skate",
  "key": "a41f28d6-1da3-4af2-8fa2-4f29b2748415",
  "description": "Seleciona o publico inicial com os dados do service",
  "queryText": "SELECT\n  BASE.*\nFROM (\n  SELECT\n    B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n    C.NAME AS NOME,\n    B.HC_NAO_DESEJA_RECEBER_EMAIL__C as NAO_DESEJA_RECEBER_EMAIL,\n    B.HC_NAO_DESEJA_RECEBER_SMS__C as NAO_DESEJA_RECEBER_SMS,\n    CASE\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n      WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n      ELSE NULL\n    END AS EMAIL,\n    CASE\n      WHEN B.HC_EMAIL_PRINCIPAL__C IN ('Brasilcap', 'Comercial', 'Pessoal') THEN 1\n      WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n      WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n      WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n      ELSE 0\n    END AS EMAIL_VALIDO,\n    CASE\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 1' THEN B.HC_CELULAR_1__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 2' THEN B.HC_CELULAR_2__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 3' THEN B.HC_CELULAR_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 3_3' THEN B.HC_CELULAR_3_3__C\n      WHEN B.HC_TELEFONE_PRINCIPAL__C = 'Celular 4' THEN B.HC_CELULAR_4__C\n      WHEN B.HC_STATUS_CELULAR_1__C IS NOT NULL THEN B.HC_CELULAR_1__C\n      WHEN B.HC_STATUS_CELULAR_2__C IS NOT NULL THEN B.HC_CELULAR_2__C\n      WHEN B.HC_STATUS_CELULAR_3__C IS NOT NULL THEN B.HC_CELULAR_3__C\n      WHEN B.HC_STATUS_CELULAR_3_3__C IS NOT NULL THEN B.HC_CELULAR_3_3__C\n      WHEN B.HC_STATUS_CELULAR_4__C IS NOT NULL THEN B.HC_CELULAR_4__C\n      ELSE NULL\n    END AS CELULAR,\n    B.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n    B.HC_CPF_CNPJ__C AS ID,\n    A.ID AS ID_CAMPANHA, \n    B.ID AS ID_CLIENTE_PARCEIRO,\n    C.ID AS ID_CONTATO,\n    B.HC_CLIENTE__C AS ID_CLIENTE,\n    B.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\n    'BR' as Locale,\n    A.HC_Mes_Inicio__c,\n    A.HC_Mes_Fim__c,\n    A.HC_Quantidade_de_clientes_sorteados__c,\n    A.HC_Valor_do_premio__c,\n\t\tROW_NUMBER() OVER(ORDER BY B.HC_CPF_CNPJ__C ASC) AS ROWNO\n  FROM (\n    SELECT\n      A.ID as CAMPAIGNID,\n      B.ID AS CLIENTEPARCEIROID,\n      C.ID AS CONTACTID,\n      row_number() over (PARTITION BY B.ID ORDER BY B.ID) AS ROW\n    FROM CAMPAIGN_SALESFORCE A\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n    INNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\n    where \n    CONTATO_NO_MARKETING__C = 1\n  OR (\n    B.HC_CLASSIFICACAO__C IN ('Cliente')\n    AND ISNULL(B.HC_PEP__C, 0) = 0\n    AND ISNULL(B.HC_CONSELHEIRO__C, 0) = 0\n    AND B.HC_IDADE__C BETWEEN 18 AND 70\n    AND B.HC_PARCEIRO__C = 'a0W6g000006R0MfEAK'\n    AND (\n      B.HC_CLASSIFICACAO__C = 'Cliente'\n      OR ( B.HC_EMAIL_BRASILCAP__C IS NOT NULL OR B.HC_EMAIL_COMERCIAL__C IS NOT NULL OR B.HC_EMAIL_PESSOAL__C IS NOT NULL )\n    )\n  )\n    ) SELECTED\n    INNER JOIN CAMPAIGN_SALESFORCE A ON SELECTED.CAMPAIGNID = A.ID\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON SELECTED.CLIENTEPARCEIROID = B.ID\n    INNER JOIN CONTACT_SALESFORCE C ON SELECTED.CONTACTID = C.ID\n  WHERE SELECTED.ROW = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP\n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= (CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C)",
  "targetName": "Tb_CampeonatoSkate",
  "targetKey": "E4652B12-EBE1-46B7-930D-5F728E0F6A73",
  "targetId": "8e499139-2e29-ed11-a5b6-d4f5ef66b08b",
  "targetDescription": "",
  "createdDate": "2022-08-31T07:15:33.603",
  "modifiedDate": "2022-09-02T20:47:16.847",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 52934,
  "isFrozen": false
}