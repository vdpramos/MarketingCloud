{
  "queryDefinitionId": "a8a2e320-f063-4c44-84f0-6eb2768e8220",
  "name": "Qr00_Base_Revenda_Ourocap_ComOTC_TMKT",
  "key": "A8A2E320-F063-4C44-84F0-6EB2768E8220",
  "description": "",
  "queryText": "SELECT\n\tBASE.*\nFROM (\n\tSELECT DISTINCT\n\t\tB.HC_CPF_CNPJ__C AS CPF_CNPJ,\n\t\treplace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (C.NAME, 'á', 'a'),'é', 'e'),'í', 'i'),'ó', 'o'),'ú', 'u'),'Á', 'A'),'É', 'E'),'Í', 'I'),'Ó', 'O'),'Ú', 'U'),'à', 'a'),'À', 'A'),'ã', 'a'),'õ', 'o'),'Ã', 'A'),  'Õ', 'O'),'â', 'a'),'ê', 'e'),'ô', 'o'),'Â', 'A'),'Ê', 'E'),'Ô', 'O'),'ç', 'c'),'Ç', 'c') as NOME,\n\t\t/*C.NAME AS NOME,*/\n\t\tB.HC_IDADE__C AS IDADE,\n\t\tB.HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\n\t\tB.HC_GENERO_DO_CLIENTE__C AS SEXO,\n\t\tB.HC_PARCEIRO__C AS PARCEIRO,\n\t\t/*CASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_ENDERECO_RESIDENCIAL__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_ENDERECO_COMERCIAL__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_ENDERECO_CORRESPONDENCIA__C\n\t\tEND AS ENDERECO,*/\n\t\tCASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_UF_RES__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_UF_COM__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_UF_COR__C\n\t\tEND AS UF,\n\t\tCASE \n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_CEP_RES__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_CEP_COM__C\n\t\t\tWHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_CEP_COR__C\n\t\tEND AS CEP,\n\t\tB.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\n\t\t'FIXO' AS TIPO_TEL_01,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\n\t\t'FIXO' AS TIPO_TEL_02,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\n\t\t'FIXO' AS TIPO_TEL_03,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\n\t\t'MÓVEL' AS TIPO_TEL_04,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\n\t\t'MÓVEL' AS TIPO_TEL_05,\n\t\tLEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\n\t\tSUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\n\t\t'MÓVEL' AS TIPO_TEL_06,\n\t\tB.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n\t\tB.HC_CLASSIFICACAO__C AS PUBLICO_ALVO,\n\t\tA.[TYPE] AS TIPO_CAMPANHA,\n\t\tA.STARTDATE AS DT_INICIO_MAILING,\n\t\tA.ENDDATE AS DT_FIM_MAILING,\n\t\tA.HC_VALIDA_ALTA_RENDA__C AS CAMPANHA_VALIDA_ENCARTEIRAMENTO,\n\t\tA.HC_VALIDA_NAO_IMPORTUNE__C AS CAMPANHA_NAO_IMPORTUNE,\n\t\tA.HC_VALIDA_RNA__C AS CAMPANHA_VALIDA_RNA,\n\t\tA.HC_PRODUTO__C AS ID_PRODUTO,\n\t\tA.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\n\t\tB.HC_CPF_CNPJ__C AS ID,\n\t\tA.ID AS ID_CAMPANHA, \n\t\tB.ID AS ID_CLIENTE_PARCEIRO,\n\t\tC.ID AS ID_CONTATO,\n\t\tB.HC_CLIENTE__C AS ID_CLIENTE,\n\t\tB.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\n\t\tD.HC_DATA_DO_ULTIMO_RESGATE__C AS DT_ULTIMO_RESGATE,\n\t\tD.HC_CANAL_RESGATE_OTC__c AS CANAL_ULTIMO_RESGATE,\n\t\tD.HC_SITUACAO__C AS TIPO_RESGATE,\n\t\tD.HC_VALOR_DA_PARCELA__C AS VALOR_PARCELA_PRODUTO,\n\t\tA.HC_EXCLUSAO_DE_COMPRA_RECENTE__C AS MESES_COMPRA_EXCLUSAO,\n\t\tA.HC_QUARENTENA__C AS MESES_QUARENTENA_EXCLUSAO,\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO,\n\t\tCASE WHEN DATEPART(WEEKDAY, GetDate()) = 6 THEN DATEADD(DAY, 3, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) ELSE DATEADD(DAY, A.HC_PROXIMA_EXECUCAO__C, DATEADD(HH, 3, A.HC_DATA_DE_EXECUCAO__C)) END AS DATA_PROXIMA_EXECUCAO\n\tFROM CAMPAIGN_SALESFORCE A\n\tINNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  AND A.HC_TIPO_DE_CLIENTE__C = B.HC_TIPO_DE_PESSOA__C\n\tINNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C\n\tINNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID\n\n\tLEFT JOIN HC_PROPOSTA__C_SALESFORCE P ON P.HC_CPF_CNPJ_TITULAR__C = B.HC_CPF_CNPJ__C \n\tAND DATEDIFF(DAY, CONVERT(CHAR(10), P.CREATEDDATE, 112), CONVERT(CHAR(10), GETDATE(), 112)) <= A.HC_COMPRA_RECENTE__C \n\n\tWHERE\n\t\tUPPER(A.[TYPE]) = 'AUTOMÁTICO'\n\t/*AND UPPER(B.HC_CLASSIFICACAO__C) = 'CLIENTE' CLIENTE SOLICITOU QUE O PARAMETRO OFSSE RETIRADO*/\n\tAND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n\t/* pendente tratar PF ou PJ\n\tAND B.HC_TIPO_DE_PESSOA__C = 'PF' \n\tAND UPPER(A.HC_FORNECEDOR__C) = 'TIVIT'\n\tAND UPPER(A.HC_FORMATO__C) = 'ONLINE' \n\tAND A.HC_VALIDA_RNA__C = 1 */\n\tAND A.PARENTID = '7016g000000FjOlAAK'\n\t/*AND CONVERT(VARCHAR, A.HC_DATA_DE_EXECUCAO__C, 112) = CONVERT(VARCHAR, GETDATE(), 112)*/\n\t/* AND CONVERT(VARCHAR, DATEADD(HH, -3, A.HC_DATA_DE_EXECUCAO__C), 8) = CONVERT(VARCHAR, GETDATE(), 8)*/\n\tAND A.ISACTIVE = 1\n\tAND\tD.HC_DATA_DO_ULTIMO_RESGATE__C BETWEEN A.HC_DATA_INICIAL_DO_PERIODO_DE_RESGATE__C AND A.HC_DATA_FIM_DO_PERIODO_DE_RESGATE__C\n\tAND D.HC_VALOR_DA_PARCELA__C BETWEEN A.HC_VALOR_MINIMO_DE_PARCELA__C AND A.HC_VALOR_MAXIMO_DA_PARCELA__C\n\tAND D.HC_SITUACAO__C IN ('Finalizado - Resgate Pago', 'Baixado por solicitação', 'Finalizado - Antecipado total')\n\tAND convert(int,D.HC_CANAL_RESGATE_OTC__c) = A.HC_CANAL_RESGATE__c\n\tAND B.HC_Classificacao__c != 'Falecido'\n\tAND B.HC_Idade__c BETWEEN 18 AND 70\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP \n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C",
  "targetName": "Tb_Base_Revenda_Ourocap_ComOTC_TMKT",
  "targetKey": "F43D3660-29EE-439B-8163-D73C258640A8",
  "targetId": "e6de2b5d-5b26-ee11-a5c3-d4f5ef66b08b",
  "targetDescription": "",
  "createdDate": "2023-07-19T11:43:08.82",
  "modifiedDate": "2023-08-29T13:46:40.75",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 66285,
  "isFrozen": false
}