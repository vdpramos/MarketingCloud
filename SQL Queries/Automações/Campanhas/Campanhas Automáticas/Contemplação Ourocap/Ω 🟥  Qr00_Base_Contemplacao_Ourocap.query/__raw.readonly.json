{
  "queryDefinitionId": "7a02b08e-84f9-4627-8361-b43a23bb59ea",
  "name": "Qr00_Base_Contemplacao_Ourocap",
  "key": "3e8885c3-bfba-4b40-bca1-b50124a94401",
  "description": "",
  "queryText": "SELECT \n  BASE.*\nFROM (  SELECT\n    C.NAME AS NOME,\n    B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n    B.HC_IDADE__C AS IDADE,\n      B.HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\n    B.HC_GENERO_DO_CLIENTE__C AS SEXO,\n    B.HC_PARCEIRO__C AS PARCEIRO,\n    B.HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n    CASE\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Brasilcap' THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Comercial' THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PRINCIPAL__C = 'Pessoal' THEN HC_EMAIL_PESSOAL__C\n      WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN HC_EMAIL_BRASILCAP__C\n      WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN HC_EMAIL_COMERCIAL__C\n      WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN HC_EMAIL_PESSOAL__C\n      ELSE NULL\n    END AS EMAIL,\n    CASE\n      WHEN B.HC_EMAIL_BRASILCAP__C IS NOT NULL THEN 1\n      WHEN B.HC_EMAIL_COMERCIAL__C IS NOT NULL THEN 1\n      WHEN B.HC_EMAIL_PESSOAL__C IS NOT NULL THEN 1\n      ELSE 0\n    END AS EMAIL_VALIDO,\n        CASE\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN HC_CELULAR_1__C\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN HC_CELULAR_2__C\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN HC_CELULAR_3__C\n      ELSE NULL\n    END AS CELULAR,\n    CASE\n      WHEN B.HC_STATUS_CELULAR_1__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_2__C = 'VÁLIDO' THEN 1\n      WHEN B.HC_STATUS_CELULAR_3__C = 'VÁLIDO' THEN 1\n      ELSE 0\n    END AS CELULAR_VALIDO,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\n    'FIXO' AS TIPO_TEL_01,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\n    'FIXO' AS TIPO_TEL_02,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\n    'FIXO' AS TIPO_TEL_03,\n      LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\n    'MÓVEL' AS TIPO_TEL_04,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\n    'MÓVEL' AS TIPO_TEL_05,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(B.HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\n    'MÓVEL' AS TIPO_TEL_06,\n    B.HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n    B.HC_CLASSIFICACAO__C AS PUBLICO_ALVO,\n    A.[TYPE] AS TIPO_CAMPANHA,\n    A.STARTDATE AS DT_INICIO_MAILING,\n    A.ENDDATE AS DT_FIM_MAILING,\n    A.HC_VALIDA_ALTA_RENDA__C AS CAMPANHA_VALIDA_ENCARTEIRAMENTO,\n    A.HC_VALIDA_NAO_IMPORTUNE__C AS CAMPANHA_NAO_IMPORTUNE,\n    A.HC_VALIDA_RNA__C AS CAMPANHA_VALIDA_RNA,\n    A.HC_PRODUTO__C AS ID_PRODUTO,\n    A.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\n    B.HC_CPF_CNPJ__C AS ID,\n    A.ID AS ID_CAMPANHA, \n    B.ID AS ID_CLIENTE_PARCEIRO,\n    C.ID AS ID_CONTATO,\n    B.HC_CLIENTE__C AS ID_CLIENTE,\n    B.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\n    D.HC_Data_Inicio_Sorteio__c AS DT_INICIO_SORTEIO,\n    A.HC_Valor_maximo_de_contemplacao__c AS Valor_Max_Contemplacao,\n    A.HC_Valor_minimo_de_contemplacao__c AS Valor_Min_Contemplacao,\n    format(A.HC_Data_inicial_de_contemplacao__c,'dd/MM/yyyy') AS Dt_Inicio_Contemplacao,\n    format(A.HC_Data_fim_de_contemplacao__c, 'dd/MM/yyyy') AS Dt_Fim_Contemplacao,\n    format (D.HC_Data_da_Ultima_Contemplacao__c,'dd/MM/yyyy') AS Dt_Ultima_Contemplacao,\n    D.HC_Numero_da_Sorte__c AS Numero_Sorteado,\n    D.HC_Valor_Premio__c AS Valor_Premio,\n    /* evitar repetição de CPFs */\n\t\tROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO,\n    getdate()+HC_Proxima_execucao__c AS DATA_PROXIMA_EXECUCAO,\n    D.ID AS Id_titulo\n  FROM (\n    SELECT\n      A.ID AS CAMPAIGN_ID,\n      B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\n      C.ID AS CONTACT_ID,\n      D.ID AS TITULO_ID,\n      ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\n    FROM CAMPAIGN_SALESFORCE A\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON 1 = 1\n    INNER JOIN HC_TITULO__C_SALESFORCE D ON D.HC_CLIENTE_X_PARCEIRO__C = B.ID \n    INNER JOIN CONTACT_SALESFORCE C ON C.HC_CPF_CNPJ__C = B.HC_CPF_CNPJ__C \n    WHERE \n        A.ID = '7016g000000NVYrAAO'\n        /*AND CONVERT(VARCHAR(10), A.HC_DATA_DE_EXECUCAO__C, 101) = CONVERT(VARCHAR(10), GETDATE(), 101)*/\n        AND (B.HC_TIPO_DE_PESSOA__C = A.HC_TIPO_DE_CLIENTE__C OR (A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ' ))\n        /*AND B.HC_CLASSIFICACAO__C = 'Cliente'*/\n        AND B.HC_NOME_PARCEIRO__C = 'BB CORRETORA'\n        AND D.HC_Data_da_Ultima_Contemplacao__c between \n                              A.HC_Data_inicial_de_contemplacao__c  AND A.HC_Data_fim_de_contemplacao__c\n        AND (D.flg_envio_campanha__c = 0 or D.Data_ultimo_envio_campanha__c < HC_Data_inicial_de_contemplacao__c)\n  ) FILTERED\n  INNER JOIN CAMPAIGN_SALESFORCE A ON FILTERED.CAMPAIGN_ID = A.ID\n  INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\n  INNER JOIN HC_TITULO__C_SALESFORCE D ON D.ID = FILTERED.TITULO_ID\n  INNER JOIN CONTACT_SALESFORCE C ON C.ID = FILTERED.CONTACT_ID\n  WHERE\n    NUMBER_OF_CPF_REPETITION = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP\n  ON BASE.ID_CAMPANHA = CAMP.ID\nWHERE\n\tCAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n\tOR BASE.ROWNO <= (CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C)",
  "targetName": "Tb_Base_Contemplacao_Ourocap",
  "targetKey": "1D8AA341-C8B5-4799-B9CA-C0E6C0BC859A",
  "targetId": "cc3324b4-27ef-eb11-a304-48df37342b90",
  "targetDescription": "",
  "createdDate": "2021-07-27T16:17:09.103",
  "modifiedDate": "2022-12-15T12:49:19.977",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 32277,
  "isFrozen": false
}