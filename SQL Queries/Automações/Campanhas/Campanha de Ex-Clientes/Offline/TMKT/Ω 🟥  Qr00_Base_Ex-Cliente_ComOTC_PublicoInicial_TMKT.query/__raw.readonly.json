{
  "queryDefinitionId": "b631b127-99d6-4372-b69e-9cac525c6a2e",
  "name": "Qr00_Base_Ex-Cliente_ComOTC_PublicoInicial_TMKT",
  "key": "7ca4a8db-76a5-4891-8bb4-931d80ea6ea0",
  "description": "",
  "queryText": "SELECT \n   BASE.*\nFROM (\n  SELECT\n    B.HC_CPF_CNPJ__C AS CPF_CNPJ,\n    replace( replace( replace( replace( replace( replace( replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (replace (C.NAME, 'á', 'a'),'é', 'e'),'í', 'i'),'ó', 'o'),'ú', 'u'),'Á', 'A'),'É', 'E'),'Í', 'I'),'Ó', 'O'),'Ú', 'U'),'à', 'a'),'À', 'A'),'ã', 'a'),'õ', 'o'),'Ã', 'A'),  'Õ', 'O'),'â', 'a'),'ê', 'e'),'ô', 'o'),'Â', 'A'),'Ê', 'E'),'Ô', 'O'),'ç', 'c'),'Ç', 'c') , '-', '') , '+', '') , '|', '') , '$', '') , '%', '') , '&', '') as NOME,\n    HC_IDADE__C AS IDADE,\n    HC_DATA_DE_NASCIMENTO__C AS DT_NASCIMENTO,\n    HC_GENERO_DO_CLIENTE__C AS SEXO,\n    B.HC_PARCEIRO__C AS PARCEIRO,\n    CASE \n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_CEP_RES__C\n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_CEP_COM__C\n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_CEP_COR__C\n    END AS CEP,\n    CASE \n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'RESIDENCIAL' THEN HC_UF_RES__C\n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'COMERCIAL' THEN HC_UF_COM__C\n      WHEN UPPER(B.HC_ENDERECO_PRINCIPAL__C) = 'CORRESPONDÊNCIA' THEN HC_UF_COR__C\n    END AS UF,\n    HC_TIPO_DE_PESSOA__C AS TIPO_PESSOA,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_01,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_RESIDENCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_01,\n    'FIXO' AS TIPO_TEL_01,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_02,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_COMERCIAL__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_02,\n    'FIXO' AS TIPO_TEL_02,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_03,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_TELEFONE_OUTRO__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_03,\n    'FIXO' AS TIPO_TEL_03,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_04,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_1__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_04,\n    'MÓVEL' AS TIPO_TEL_04,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_05,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_2__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_05,\n    'MÓVEL' AS TIPO_TEL_05,\n    LEFT(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 2) AS DDD_TEL_06,\n    SUBSTRING(REPLACE(REPLACE(REPLACE(REPLACE(HC_CELULAR_3__C, '(', ''), ')', ''), ' ', ''), '-', ''), 3, 9) AS TEL_06,\n    'MÓVEL' AS TIPO_TEL_06,\n    HC_TELEFONE_PRINCIPAL__C AS TEL_PRINCIPAL,\n    HC_CLASSIFICACAO__C AS PUBLICO_ALVO,\n    A.[TYPE] AS TIPO_CAMPANHA,\n    A.STARTDATE AS DT_INICIO_MAILING,\n    A.ENDDATE AS DT_FIM_MAILING,\n    A.HC_VALIDA_ALTA_RENDA__C AS CAMPANHA_VALIDA_ENCARTEIRAMENTO,\n    A.HC_VALIDA_NAO_IMPORTUNE__C AS CAMPANHA_NAO_IMPORTUNE,\n    A.HC_VALIDA_RNA__C AS CAMPANHA_VALIDA_RNA,\n    A.HC_PRODUTO__C AS ID_PRODUTO,\n    A.HC_PRECO_DO_PRODUTO__C AS ID_PRODUTO_VALOR,\n    B.HC_CPF_CNPJ__C AS ID,\n    A.ID AS ID_CAMPANHA, \n    B.ID AS ID_CLIENTE_PARCEIRO,\n    C.ID AS ID_CONTATO,\n    B.HC_Cliente__c AS ID_CLIENTE,\n    B.HC_CPF_CNPJ_CODIGO_DO_PARCEIRO__C AS CPF_CNPJ_CODIGO_DO_PARCEIRO,\n    ROW_NUMBER() OVER(ORDER BY B.ID ASC) AS ROWNO\n  FROM (\n    SELECT\n      A.ID AS CAMPAIGN_ID,\n      B.ID AS RELACAO_CLIENTE_PARCEIRO_ID,\n      C.ID AS CONTACT_ID,\n      ROW_NUMBER() OVER(PARTITION BY B.ID ORDER BY B.ID ASC) AS NUMBER_OF_CPF_REPETITION\n    FROM CAMPAIGN_SALESFORCE A\n    INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON A.HC_PARCEIRO__C = B.HC_PARCEIRO__C\n                              AND A.[TYPE] = B.HC_CLASSIFICACAO__C\n    INNER JOIN Contact_Salesforce C ON C.HC_CPF_CNPJ__c = B.HC_CPF_CNPJ__c\n    LEFT JOIN HC_PROPOSTA__C_SALESFORCE P ON P.HC_CPF_CNPJ_TITULAR__C = B.HC_CPF_CNPJ__C \n      AND DATEDIFF(DAY, CONVERT(CHAR(10), P.CREATEDDATE, 112), CONVERT(CHAR(10), GETDATE(), 112)) <= A.HC_COMPRA_RECENTE__C\n    LEFT JOIN TB_BASE_QUARENTENA Q ON Q.CPF_CNPJ = B.HC_CPF_CNPJ__C \n      AND Q.DATA_PARTICIPACAO_CAMPANHA > DATEADD(DD, -90, GETDATE())\n      /* Remove ja adicionados */\n    LEFT JOIN Publico_Apto_Ex_Clientes_TMKT aptos ON aptos.CPF_CNPJ = B.HC_CPF_CNPJ__C\n    LEFT JOIN Publico_Inapto_Ex_Clientes_TMKT inaptos ON inaptos.CPF_CNPJ = B.HC_CPF_CNPJ__C\n    WHERE\n          aptos.CPF_CNPJ IS NULL \n      AND inaptos.CPF_CNPJ IS NULL\n      /* AND B.HC_RNA__c = '000' */\n      /* Remove quarentena */   \n      AND Q.CPF_CNPJ IS NULL\n      AND A.HC_FORMATO__C = 'Offline'\n      AND (A.HC_TIPO_DE_CLIENTE__C = b.HC_TIPO_DE_PESSOA__C OR A.HC_TIPO_DE_CLIENTE__C = 'PF E PJ')\n      /*AND A.HC_VALIDA_RNA__C = 1\n      AND CONVERT(VARCHAR, A.HC_DATA_DE_EXECUCAO__C, 112) = CONVERT(VARCHAR, GETDATE(), 112)\n      AND A.HC_CAMPANHA_EXECUTADA_NO_MKT__C = 0*/\n      \n\n      AND B.ENCARTEIRAMENTO__C NOT IN ('ESTILO','PRIVATE','RURAL ESTILO','PRIVATE MISTA','PRIVATE MISTA 3','PRIVATE AFLUENTE',\n                                         'PRIVATE JUNIOR','PRIVATE FAMILY OFFIC','SPECIAL','PRIVATE SOFISTICADO','DESC_ENCARTEIRAMENTO',\n                                         'PRIVATE ULTRA-HIGH','ESTILO REMOTO','PRIVATE MISTA 2','PRIVATE PRODUTOR RUR','GRUPO NEG PRIVATE',\n                                         'PREMIUM','PRIVATE SUPERIOR','PRIVATE PLENO','PRIVATE SENIOR')\n      \n\n\n      AND A.HC_FORNECEDOR__C = 'TMKT'\n      AND A.IsActive = 1\n      AND ISNULL(B.HC_CONSELHEIRO__C, 0) = 0\n      AND ISNULL(B.HC_PEP__C, 0) = 0\n      AND ISNULL(B.HC_NAO_DESEJA_RECEBER_LIGACOES__C, 0) = 0\n      AND ISNULL(B.HC_NAO_DESEJA_RECEBER_TODOS_MEIOS__C, 0) = 0\n      AND B.HC_IDADE__C BETWEEN 18 AND 70\n      AND B.HC_Endereco_Principal__c IS NOT NULL\n      /* verifica se possui sobrenome */\n      AND CHARINDEX(' ', C.NAME) > 0\n      AND ((B.HC_Conta_Principal__c = 'Conta 1' AND hc_TIPO_DA_CONTA_1__C = 'CONTA CORRENTE')\n      OR (B.HC_Conta_Principal__c = 'Conta 2' AND hc_TIPO_DA_CONTA_2__C = 'CONTA CORRENTE')\n      )\n      AND (\n        (HC_Status_Tel_Comercial__c = 'VÁLIDO' AND HC_TELEFONE_COMERCIAL__C IS NOT NULL)\n        OR (HC_Status_Tel_Outro__c = 'VÁLIDO' AND HC_TELEFONE_OUTRO__C IS NOT NULL)\n        OR (HC_Status_Tel_Residencial__c = 'VÁLIDO' AND HC_TELEFONE_RESIDENCIAL__C IS NOT NULL)\n        OR (HC_Status_Celular_1__c = 'VÁLIDO' AND HC_CELULAR_1__C IS NOT NULL)\n        OR (HC_Status_Celular_2__c = 'VÁLIDO' AND HC_CELULAR_2__C IS NOT NULL)\n        OR (HC_Status_Celular_3__c = 'VÁLIDO' AND HC_CELULAR_3__C IS NOT NULL)\n      ) \n        ) FILTERED\n  INNER JOIN CAMPAIGN_SALESFORCE A ON A.ID = FILTERED.CAMPAIGN_ID\n  INNER JOIN HC_RELACAO_CLIENTE_PARCEIRO__C_SALESFORCE B ON B.ID = FILTERED.RELACAO_CLIENTE_PARCEIRO_ID\n  INNER JOIN Contact_Salesforce C ON C.ID = FILTERED.CONTACT_ID\n  WHERE FILTERED.NUMBER_OF_CPF_REPETITION = 1\n) BASE\nINNER JOIN\n  CAMPAIGN_SALESFORCE CAMP\n  ON BASE.ID_CAMPANHA = CAMP.ID\nINNER JOIN  HC_Titulo__c_Salesforce T ON T.HC_CPF_CNPJ_Titular__c = BASE.CPF_CNPJ\nWHERE\n  (CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C IS NULL\n  OR BASE.ROWNO <= (CAMP.HC_QUANTIDADE_DE_CONTATOS_NO_MAILING__C*3))\n  AND T.HC_Situacao__c IN ('Baixado Resgate Pago', 'Finalizado - Resgate Pago', 'Finalizado - Antecipado Total')\n",
  "targetName": "Tb_Base_Ex_Cliente_ComOTC_TMKT",
  "targetKey": "EE20370A-C9B9-4E72-AE05-789F84BD99EF",
  "targetId": "2a7431fa-bda3-eb11-a2fc-48df37342b91",
  "targetDescription": "",
  "createdDate": "2021-04-22T16:58:21.977",
  "modifiedDate": "2023-08-29T07:43:02.76",
  "targetUpdateTypeId": 0,
  "targetUpdateTypeName": "Overwrite",
  "categoryId": 33121,
  "isFrozen": false
}